<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Protocol.Streamlet.Global.State</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
</head>
<body>
<h1 id="global-state-of-the-entire-system.">Global state of the entire
system.</h1>
<!--
<pre class="Agda"><a id="53" class="Symbol">{-#</a> <a id="57" class="Keyword">OPTIONS</a> <a id="65" class="Pragma">--safe</a> <a id="72" class="Symbol">#-}</a>
<a id="76" class="Keyword">open</a> <a id="81" class="Keyword">import</a> <a id="88" href="Prelude.html" class="Module">Prelude</a>
<a id="96" class="Keyword">open</a> <a id="101" class="Keyword">import</a> <a id="108" href="Hash.html" class="Module">Hash</a>

<a id="114" class="Keyword">open</a> <a id="119" class="Keyword">import</a> <a id="126" href="Protocol.Streamlet.Base.html" class="Module">Protocol.Streamlet.Base</a>
<a id="150" class="Keyword">open</a> <a id="155" class="Keyword">import</a> <a id="162" href="Protocol.Streamlet.Assumptions.html" class="Module">Protocol.Streamlet.Assumptions</a>

<a id="194" class="Keyword">module</a> <a id="201" href="Protocol.Streamlet.Global.State.html" class="Module">Protocol.Streamlet.Global.State</a> <a id="233" class="Symbol">(</a><a id="234" href="Protocol.Streamlet.Global.State.html#234" class="Bound">⋯</a> <a id="236" class="Symbol">:</a> <a id="238" class="Symbol">_)</a> <a id="241" class="Symbol">(</a><a id="242" class="Keyword">open</a> <a id="247" href="Protocol.Streamlet.Assumptions.html#222" class="Module">Assumptions</a> <a id="259" href="Protocol.Streamlet.Global.State.html#234" class="Bound">⋯</a><a id="260" class="Symbol">)</a> <a id="262" class="Keyword">where</a>

<a id="269" class="Keyword">open</a> <a id="274" class="Keyword">import</a> <a id="281" href="Protocol.Streamlet.Message.html" class="Module">Protocol.Streamlet.Message</a> <a id="308" href="Protocol.Streamlet.Global.State.html#234" class="Bound">⋯</a>
<a id="310" class="Keyword">open</a> <a id="315" class="Keyword">import</a> <a id="322" href="Protocol.Streamlet.Local.State.html" class="Module">Protocol.Streamlet.Local.State</a> <a id="353" href="Protocol.Streamlet.Global.State.html#234" class="Bound">⋯</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Protocol.Streamlet.Local.Chain.html" class="Module">Protocol.Streamlet.Local.Chain</a> <a id="398" href="Protocol.Streamlet.Global.State.html#234" class="Bound">⋯</a>
</pre>-->
The global state consists of a local state for each <em>honest</em>
node.
<pre class="Agda"><a id="StateMap"></a><a id="484" href="Protocol.Streamlet.Global.State.html#484" class="Function">StateMap</a> <a id="493" class="Symbol">:</a> <a id="495" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="500" href="Protocol.Streamlet.Global.State.html#484" class="Function">StateMap</a> <a id="509" class="Symbol">=</a> <a id="511" href="Protocol.Streamlet.Assumptions.html#3602" class="Function">HonestVec</a> <a id="521" href="Protocol.Streamlet.Local.State.html#883" class="Record">LocalState</a>
</pre>
Other than that, it records the current epoch, in-flight messages, and
the whole history of previous messages.
<pre class="Agda"><a id="656" class="Keyword">record</a> <a id="GlobalState"></a><a id="663" href="Protocol.Streamlet.Global.State.html#663" class="Record">GlobalState</a> <a id="675" class="Symbol">:</a> <a id="677" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="682" class="Keyword">where</a>
  <a id="690" class="Keyword">constructor</a> <a id="mkGlobalState"></a><a id="702" href="Protocol.Streamlet.Global.State.html#702" class="InductiveConstructor">mkGlobalState</a>
  <a id="718" class="Keyword">field</a>
    <a id="GlobalState.e-now"></a><a id="728" href="Protocol.Streamlet.Global.State.html#728" class="Field">e-now</a>         <a id="742" class="Symbol">:</a> <a id="744" href="Protocol.Streamlet.Base.html#83" class="Function">Epoch</a>          <a id="759" class="Comment">-- The current epoch.</a>
    <a id="GlobalState.stateMap"></a><a id="785" href="Protocol.Streamlet.Global.State.html#785" class="Field">stateMap</a>      <a id="799" class="Symbol">:</a> <a id="801" href="Protocol.Streamlet.Global.State.html#484" class="Function">StateMap</a>       <a id="816" class="Comment">-- A map assigning each PID its local state.</a>
    <a id="GlobalState.networkBuffer"></a><a id="865" href="Protocol.Streamlet.Global.State.html#865" class="Field">networkBuffer</a> <a id="879" class="Symbol">:</a> <a id="881" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="886" href="Protocol.Streamlet.Message.html#882" class="Record">Envelope</a>  <a id="896" class="Comment">-- Messages in transit on the network.</a>
    <a id="GlobalState.history"></a><a id="939" href="Protocol.Streamlet.Global.State.html#939" class="Field">history</a>       <a id="953" class="Symbol">:</a> <a id="955" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="960" href="Protocol.Streamlet.Message.html#298" class="Datatype">Message</a>   <a id="970" class="Comment">-- All messages seen so far.</a>
</pre>
<!--
<pre class="Agda"><a id="1016" class="Keyword">open</a> <a id="1021" href="Protocol.Streamlet.Global.State.html#663" class="Module">GlobalState</a> <a id="1033" class="Keyword">public</a>
<a id="1040" class="Keyword">variable</a> <a id="1049" href="Protocol.Streamlet.Global.State.html#1049" class="Generalizable">s</a> <a id="1051" href="Protocol.Streamlet.Global.State.html#1051" class="Generalizable">s′</a> <a id="1054" href="Protocol.Streamlet.Global.State.html#1054" class="Generalizable">s″</a> <a id="1057" class="Symbol">:</a> <a id="1059" href="Protocol.Streamlet.Global.State.html#663" class="Record">GlobalState</a>
</pre>-->
The initial global state starts at epoch 1 with no messages and initial
local states.
<pre class="Agda"><a id="initStateMap"></a><a id="1174" href="Protocol.Streamlet.Global.State.html#1174" class="Function">initStateMap</a> <a id="1187" class="Symbol">:</a> <a id="1189" href="Protocol.Streamlet.Global.State.html#484" class="Function">StateMap</a>
<a id="1198" href="Protocol.Streamlet.Global.State.html#1174" class="Function">initStateMap</a> <a id="1211" class="Symbol">=</a> <a id="1213" href="Data.Vec.Base.html#6509" class="Function">V.replicate</a> <a id="1225" class="Symbol">_</a> <a id="1227" href="Protocol.Streamlet.Local.State.html#1166" class="Function">initLocalState</a>

<a id="initGlobalState"></a><a id="1243" href="Protocol.Streamlet.Global.State.html#1243" class="Function">initGlobalState</a> <a id="1259" class="Symbol">:</a> <a id="1261" href="Protocol.Streamlet.Global.State.html#663" class="Record">GlobalState</a>
<a id="1273" href="Protocol.Streamlet.Global.State.html#1243" class="Function">initGlobalState</a> <a id="1289" class="Symbol">=</a> <a id="1291" href="Protocol.Streamlet.Global.State.html#702" class="InductiveConstructor">mkGlobalState</a> <a id="1305" class="Number">1</a> <a id="1307" href="Protocol.Streamlet.Global.State.html#1174" class="Function">initStateMap</a> <a id="1320" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="1323" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
</pre>
<!--
<pre class="Agda"><a id="1343" class="Keyword">instance</a>
  <a id="Def-StateMap"></a><a id="1354" href="Protocol.Streamlet.Global.State.html#1354" class="Function">Def-StateMap</a>     <a id="1371" class="Symbol">=</a> <a id="1373" href="Prelude.Default.html#123" class="Record">Default</a> <a id="1381" class="Symbol">_</a> <a id="1383" href="Function.Base.html#4486" class="Function Operator">∋</a> <a id="1385" class="Symbol">λ</a> <a id="1387" class="Keyword">where</a> <a id="1393" class="Symbol">.</a><a id="1394" href="Prelude.Default.html#163" class="Field">def</a> <a id="1398" class="Symbol">→</a> <a id="1400" href="Protocol.Streamlet.Global.State.html#1174" class="Function">initStateMap</a>
  <a id="Def-GlobalState"></a><a id="1415" href="Protocol.Streamlet.Global.State.html#1415" class="Function">Def-GlobalState</a>  <a id="1432" class="Symbol">=</a> <a id="1434" href="Prelude.Default.html#123" class="Record">Default</a> <a id="1442" class="Symbol">_</a> <a id="1444" href="Function.Base.html#4486" class="Function Operator">∋</a> <a id="1446" class="Symbol">λ</a> <a id="1448" class="Keyword">where</a> <a id="1454" class="Symbol">.</a><a id="1455" href="Prelude.Default.html#163" class="Field">def</a> <a id="1459" class="Symbol">→</a> <a id="1461" href="Protocol.Streamlet.Global.State.html#1243" class="Function">initGlobalState</a>
  <a id="Init-GlobalState"></a><a id="1479" href="Protocol.Streamlet.Global.State.html#1479" class="Function">Init-GlobalState</a> <a id="1496" class="Symbol">=</a> <a id="1498" href="Prelude.Initial.html#87" class="Record">HasInitial</a> <a id="1509" class="Symbol">_</a> <a id="1511" href="Function.Base.html#4486" class="Function Operator">∋</a> <a id="1513" class="Symbol">λ</a> <a id="1515" class="Keyword">where</a> <a id="1521" class="Symbol">.</a><a id="1522" href="Prelude.Initial.html#141" class="Field">Initial</a> <a id="1530" class="Symbol">→</a> <a id="1532" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_≡</a> <a id="1535" href="Protocol.Streamlet.Global.State.html#1243" class="Function">initGlobalState</a>
</pre>-->
<pre class="Agda"><a id="_＠_"></a><a id="1568" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">_＠_</a> <a id="1572" class="Symbol">:</a> <a id="1574" href="Protocol.Streamlet.Global.State.html#663" class="Record">GlobalState</a> <a id="1586" class="Symbol">→</a> <a id="1588" class="Symbol">∀</a> <a id="1590" href="Protocol.Streamlet.Global.State.html#1590" class="Bound">p</a> <a id="1592" class="Symbol">⦃</a> <a id="1594" href="Protocol.Streamlet.Global.State.html#1594" class="Bound">_</a> <a id="1596" class="Symbol">:</a> <a id="1598" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="1605" href="Protocol.Streamlet.Global.State.html#1590" class="Bound">p</a> <a id="1607" class="Symbol">⦄</a> <a id="1609" class="Symbol">→</a> <a id="1611" href="Protocol.Streamlet.Local.State.html#883" class="Record">LocalState</a>
<a id="1622" href="Protocol.Streamlet.Global.State.html#1622" class="Bound">s</a> <a id="1624" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="1626" href="Protocol.Streamlet.Global.State.html#1626" class="Bound">p</a> <a id="1628" class="Symbol">=</a> <a id="1630" href="Prelude.PVec.html#542" class="Function">pLookup</a> <a id="1638" class="Symbol">(</a><a id="1639" href="Protocol.Streamlet.Global.State.html#1622" class="Bound">s</a> <a id="1641" class="Symbol">.</a><a id="1642" href="Protocol.Streamlet.Global.State.html#785" class="Field">stateMap</a><a id="1650" class="Symbol">)</a> <a id="1652" class="Symbol">(</a><a id="1653" href="Protocol.Streamlet.Global.State.html#1626" class="Bound">p</a> <a id="1655" href="Prelude.Init.html#7248" class="InductiveConstructor Operator">,·</a> <a id="1658" href="Function.Base.html#4736" class="Function">it</a><a id="1660" class="Symbol">)</a>
</pre>
</body>
</html>
