# Global properties of the whole Streamlet protocol

<!--
<pre class="Agda"><a id="67" class="Symbol">{-#</a> <a id="71" class="Keyword">OPTIONS</a> <a id="79" class="Pragma">--safe</a> <a id="86" class="Symbol">#-}</a>
<a id="90" class="Keyword">open</a> <a id="95" class="Keyword">import</a> <a id="102" href="Prelude.html" class="Module">Prelude</a> <a id="110" class="Keyword">hiding</a> <a id="117" class="Symbol">(</a><a id="118" href="Prelude.Init.html#289" class="Generalizable">ℓ</a><a id="119" class="Symbol">)</a>
<a id="121" class="Keyword">open</a> <a id="126" class="Keyword">import</a> <a id="133" href="Hash.html" class="Module">Hash</a>
<a id="138" class="Keyword">open</a> <a id="143" class="Keyword">import</a> <a id="150" href="Protocol.Streamlet.Assumptions.html" class="Module">Protocol.Streamlet.Assumptions</a>

<a id="182" class="Keyword">module</a> <a id="189" class="Symbol">@</a><a id="190" class="Symbol">0</a> <a id="192" href="Protocol.Streamlet.Consistency.html" class="Module">Protocol.Streamlet.Consistency</a> <a id="223" class="Symbol">(</a><a id="224" href="Protocol.Streamlet.Consistency.html#224" class="Bound">⋯</a> <a id="226" class="Symbol">:</a> <a id="228" class="Symbol">_)</a> <a id="231" class="Symbol">(</a><a id="232" class="Keyword">open</a> <a id="237" href="Protocol.Streamlet.Assumptions.html#222" class="Module">Assumptions</a> <a id="249" href="Protocol.Streamlet.Consistency.html#224" class="Bound">⋯</a><a id="250" class="Symbol">)</a> <a id="252" class="Keyword">where</a>

<a id="259" class="Keyword">open</a> <a id="264" class="Keyword">import</a> <a id="271" href="Protocol.Streamlet.html" class="Module">Protocol.Streamlet</a> <a id="290" href="Protocol.Streamlet.Consistency.html#224" class="Bound">⋯</a>
  <a id="294" class="Keyword">hiding</a> <a id="301" class="Symbol">(</a><a id="302" href="Protocol.Streamlet.Local.Chain.html#1471" class="Generalizable">vch</a><a id="305" class="Symbol">;</a> <a id="307" href="Protocol.Streamlet.Local.Chain.html#1475" class="Generalizable">vch′</a><a id="311" class="Symbol">;</a> <a id="313" href="Protocol.Streamlet.Local.State.html#1083" class="Generalizable">ls</a><a id="315" class="Symbol">;</a> <a id="317" href="Protocol.Streamlet.Message.html#403" class="Generalizable">ms</a><a id="319" class="Symbol">;</a> <a id="321" href="Protocol.Streamlet.Message.html#406" class="Generalizable">ms′</a><a id="324" class="Symbol">)</a>

<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Protocol.Streamlet.Decidability.html" class="Module">Protocol.Streamlet.Decidability</a> <a id="371" href="Protocol.Streamlet.Consistency.html#224" class="Bound">⋯</a>
<a id="373" class="Keyword">open</a> <a id="378" class="Keyword">import</a> <a id="385" href="Protocol.Streamlet.Invariants.html" class="Module">Protocol.Streamlet.Invariants</a> <a id="415" href="Protocol.Streamlet.Consistency.html#224" class="Bound">⋯</a>
</pre>-->

## Global invariants

We characterize the invariants that hold for global states
obtained from valid executions.

All honest nodes should have valid local states,
in addition to global invariants that relate different participants:

- *Message sharing:*
a participant always stores their own messages in their local message state
(even if observed by another participant).

- *Increasing epochs:*
partipants cannot vote for a block of a previous epoch,
i.e. the epochs of blocks being voted on is *monotonic*.

### Honest intersection

The intersection of two quorums (unique votes from a majority of at least 2n/3 nodes)
contains at least one honest node.

<pre class="Agda"><a id="honest-intersection"></a><a id="1092" href="Protocol.Streamlet.Consistency.html#1092" class="Function">honest-intersection</a> <a id="1112" class="Symbol">:</a> <a id="1114" class="Symbol">∀</a> <a id="1116" class="Symbol">{</a><a id="1117" href="Protocol.Streamlet.Consistency.html#1117" class="Bound">vs</a> <a id="1120" href="Protocol.Streamlet.Consistency.html#1120" class="Bound">vs′</a> <a id="1124" class="Symbol">:</a> <a id="1126" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1131" href="Protocol.Streamlet.Assumptions.html#512" class="Function">Pid</a><a id="1134" class="Symbol">}</a> <a id="1136" class="Symbol">→</a>
  <a id="1140" href="Prelude.InferenceRules.html#56097" class="Function Operator">∙</a> <a id="1142" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="1149" href="Protocol.Streamlet.Consistency.html#1117" class="Bound">vs</a>
  <a id="1154" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1156" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="1163" href="Protocol.Streamlet.Consistency.html#1120" class="Bound">vs′</a>
  <a id="1169" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1171" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="1182" href="Protocol.Streamlet.Consistency.html#1117" class="Bound">vs</a>
  <a id="1187" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1189" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="1200" href="Protocol.Streamlet.Consistency.html#1120" class="Bound">vs′</a>
    <a id="1208" href="Prelude.InferenceRules.html#13338" class="Function Operator">─────────────────────────────────────────</a>
    <a id="1254" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a> <a id="1256" href="Protocol.Streamlet.Assumptions.html#512" class="Function">Pid</a> <a id="1260" class="Symbol">(λ</a> <a id="1263" href="Protocol.Streamlet.Consistency.html#1263" class="Bound">p</a> <a id="1265" class="Symbol">→</a> <a id="1267" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="1274" href="Protocol.Streamlet.Consistency.html#1263" class="Bound">p</a> <a id="1276" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1278" href="Protocol.Streamlet.Consistency.html#1263" class="Bound">p</a> <a id="1280" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="1282" href="Protocol.Streamlet.Consistency.html#1117" class="Bound">vs</a> <a id="1285" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1287" href="Protocol.Streamlet.Consistency.html#1263" class="Bound">p</a> <a id="1289" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="1291" href="Protocol.Streamlet.Consistency.html#1120" class="Bound">vs′</a><a id="1294" class="Symbol">)</a>
<a id="1296" href="Protocol.Streamlet.Consistency.html#1092" class="Function">honest-intersection</a> <a id="1316" class="Symbol">{</a><a id="1317" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a><a id="1319" class="Symbol">}{</a><a id="1321" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a><a id="1324" class="Symbol">}</a> <a id="1326" href="Protocol.Streamlet.Consistency.html#1326" class="Bound">u</a> <a id="1328" href="Protocol.Streamlet.Consistency.html#1328" class="Bound">u′</a> <a id="1331" href="Protocol.Streamlet.Consistency.html#1331" class="Bound">maj</a> <a id="1335" href="Protocol.Streamlet.Consistency.html#1335" class="Bound">maj′</a> <a id="1340" class="Symbol">=</a>
  <a id="1344" class="Keyword">let</a>
    <a id="1352" href="Protocol.Streamlet.Consistency.html#1352" class="Bound">vs∩</a> <a id="1356" class="Symbol">=</a> <a id="1358" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="1361" href="Prelude.Lists.html#15510" class="Function Operator">∩</a> <a id="1363" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a>

    <a id="1372" href="Protocol.Streamlet.Consistency.html#1372" class="Bound">u∩</a> <a id="1375" class="Symbol">:</a> <a id="1377" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="1384" href="Protocol.Streamlet.Consistency.html#1352" class="Bound">vs∩</a>
    <a id="1392" href="Protocol.Streamlet.Consistency.html#1372" class="Bound">u∩</a> <a id="1395" class="Symbol">=</a> <a id="1397" href="Prelude.Lists.html#15660" class="Function">Unique-∩</a> <a id="1406" href="Protocol.Streamlet.Consistency.html#1326" class="Bound">u</a>

    <a id="1413" href="Protocol.Streamlet.Consistency.html#1413" class="Bound">len≥n/3</a> <a id="1421" class="Symbol">:</a> <a id="1423" class="Number">3</a> <a id="1425" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1427" href="Data.List.Base.html#5083" class="Function">length</a> <a id="1434" href="Protocol.Streamlet.Consistency.html#1352" class="Bound">vs∩</a> <a id="1438" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="1440" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
    <a id="1450" href="Protocol.Streamlet.Consistency.html#1413" class="Bound">len≥n/3</a> <a id="1458" class="Symbol">=</a> <a id="1460" class="Keyword">let</a> <a id="1464" class="Keyword">open</a> <a id="1469" href="Prelude.Init.html#1344" class="Module">Nat</a><a id="1472" class="Symbol">;</a> <a id="1474" class="Keyword">open</a> <a id="1479" href="Data.Nat.Properties.html#13933" class="Module">≤-Reasoning</a> <a id="1491" class="Keyword">in</a>
      <a id="1500" href="Relation.Binary.Reasoning.Syntax.html#1510" class="Function Operator">≤-Reasoning.begin</a>
        <a id="1526" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
      <a id="1538" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">≡˘⟨</a> <a id="1542" href="Data.Nat.Properties.html#21011" class="Function">*-identityˡ</a> <a id="1554" class="Symbol">_</a> <a id="1556" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">⟩</a>
        <a id="1566" class="Number">1</a> <a id="1568" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1570" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
      <a id="1582" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="1585" href="Data.Nat.Properties.html#51408" class="Function">*-distribʳ-∸</a> <a id="1598" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1604" class="Number">4</a> <a id="1606" class="Number">3</a> <a id="1608" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
        <a id="1618" class="Number">4</a> <a id="1620" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1622" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1628" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="1630" class="Number">3</a> <a id="1632" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1634" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
      <a id="1646" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="1649" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="1654" class="Symbol">(</a><a id="1655" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸</a> <a id="1658" class="Number">3</a> <a id="1660" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1662" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a><a id="1667" class="Symbol">)</a> <a id="1669" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1671" href="Data.Nat.Properties.html#21625" class="Function">*-distribʳ-+</a> <a id="1684" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1690" class="Number">2</a> <a id="1692" class="Number">2</a> <a id="1694" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
        <a id="1704" class="Symbol">(</a><a id="1705" class="Number">2</a> <a id="1707" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1709" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1715" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="1717" class="Number">2</a> <a id="1719" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1721" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a><a id="1726" class="Symbol">)</a> <a id="1728" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="1730" class="Number">3</a> <a id="1732" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1734" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
      <a id="1746" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">≤⟨</a> <a id="1749" href="Data.Nat.Properties.html#46578" class="Function">∸-monoˡ-≤</a> <a id="1759" class="Symbol">(</a><a id="1760" class="Number">3</a> <a id="1762" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1764" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a><a id="1769" class="Symbol">)</a>
       <a id="1778" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1780" href="Relation.Binary.Reasoning.Syntax.html#1510" class="Function Operator">≤-Reasoning.begin</a>
           <a id="1809" class="Number">2</a> <a id="1811" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1813" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1819" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="1821" class="Number">2</a> <a id="1823" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1825" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
         <a id="1840" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">≤⟨</a> <a id="1843" href="Data.Nat.Properties.html#19083" class="Function">+-monoʳ-≤</a> <a id="1853" class="Symbol">(</a><a id="1854" class="Number">2</a> <a id="1856" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1858" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a><a id="1863" class="Symbol">)</a> <a id="1865" href="Protocol.Streamlet.Consistency.html#1335" class="Bound">maj′</a>  <a id="1871" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">⟩</a>
           <a id="1884" class="Number">2</a> <a id="1886" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1888" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="1894" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="1896" class="Number">3</a> <a id="1898" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1900" href="Data.List.Base.html#5083" class="Function">length</a> <a id="1907" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a>
         <a id="1920" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">≤⟨</a> <a id="1923" href="Data.Nat.Properties.html#18993" class="Function">+-monoˡ-≤</a> <a id="1933" class="Symbol">_</a> <a id="1935" href="Protocol.Streamlet.Consistency.html#1331" class="Bound">maj</a> <a id="1939" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">⟩</a>
           <a id="1952" class="Number">3</a> <a id="1954" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1956" href="Data.List.Base.html#5083" class="Function">length</a> <a id="1963" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="1966" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="1968" class="Number">3</a> <a id="1970" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="1972" href="Data.List.Base.html#5083" class="Function">length</a> <a id="1979" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a>
         <a id="1992" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">≡˘⟨</a> <a id="1996" href="Data.Nat.Properties.html#21935" class="Function">*-distribˡ-+</a> <a id="2009" class="Number">3</a> <a id="2011" class="Symbol">(</a><a id="2012" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2019" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a><a id="2021" class="Symbol">)</a> <a id="2023" class="Symbol">_</a> <a id="2025" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">⟩</a>
           <a id="2038" class="Number">3</a> <a id="2040" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="2042" class="Symbol">(</a><a id="2043" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2050" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="2053" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2055" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2062" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a><a id="2065" class="Symbol">)</a>
         <a id="2076" href="Relation.Binary.Reasoning.Syntax.html#12283" class="Function Operator">≤-Reasoning.∎</a>
       <a id="2097" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">⟩</a>
        <a id="2107" class="Number">3</a> <a id="2109" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="2111" class="Symbol">(</a><a id="2112" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2119" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="2122" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2124" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2131" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a><a id="2134" class="Symbol">)</a> <a id="2136" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="2138" class="Number">3</a> <a id="2140" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="2142" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a>
      <a id="2154" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">≡˘⟨</a> <a id="2158" href="Data.Nat.Properties.html#51834" class="Function">*-distribˡ-∸</a> <a id="2171" class="Number">3</a> <a id="2173" class="Symbol">_</a> <a id="2175" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a> <a id="2181" href="Relation.Binary.Reasoning.Syntax.html#11477" class="Function">⟩</a>
        <a id="2191" class="Number">3</a> <a id="2193" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="2195" class="Symbol">(</a><a id="2196" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2203" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="2206" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2208" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2215" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a> <a id="2219" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="2221" href="Protocol.Streamlet.Assumptions.html#439" class="Field">nodes</a><a id="2226" class="Symbol">)</a>
      <a id="2234" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">≤⟨</a> <a id="2237" href="Data.Nat.Properties.html#26828" class="Function">*-mono-≤</a> <a id="2246" class="Symbol">{</a><a id="2247" class="Argument">x</a> <a id="2249" class="Symbol">=</a> <a id="2251" class="Number">3</a><a id="2252" class="Symbol">}</a> <a id="2254" href="Data.Nat.Properties.html#5242" class="Function">≤-refl</a> <a id="2261" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2263" href="Prelude.Lists.html#16799" class="Function">length-∩</a> <a id="2272" href="Protocol.Streamlet.Consistency.html#1326" class="Bound">u</a> <a id="2274" href="Protocol.Streamlet.Consistency.html#1328" class="Bound">u′</a> <a id="2277" href="Relation.Binary.Reasoning.Syntax.html#5482" class="Function">⟩</a>
        <a id="2287" class="Number">3</a> <a id="2289" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="2291" href="Data.List.Base.html#5083" class="Function">length</a> <a id="2298" href="Protocol.Streamlet.Consistency.html#1352" class="Bound">vs∩</a>
      <a id="2308" href="Relation.Binary.Reasoning.Syntax.html#12283" class="Function Operator">≤-Reasoning.∎</a>

    <a id="2327" href="Protocol.Streamlet.Consistency.html#2327" class="Bound">∃p</a> <a id="2330" class="Symbol">:</a> <a id="2332" href="Prelude.Anyable.html#184" class="Field">Any</a> <a id="2336" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="2343" href="Protocol.Streamlet.Consistency.html#1352" class="Bound">vs∩</a>
    <a id="2351" href="Protocol.Streamlet.Consistency.html#2327" class="Bound">∃p</a> <a id="2354" class="Symbol">=</a> <a id="2356" href="Protocol.Streamlet.Assumptions.html#2324" class="Function">honestFromMajority</a> <a id="2375" href="Protocol.Streamlet.Consistency.html#1372" class="Bound">u∩</a> <a id="2378" href="Protocol.Streamlet.Consistency.html#1413" class="Bound">len≥n/3</a>

    <a id="2391" href="Protocol.Streamlet.Consistency.html#2391" class="Bound">p</a> <a id="2393" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2395" href="Protocol.Streamlet.Consistency.html#2395" class="Bound">p∈vs</a> <a id="2400" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2402" href="Protocol.Streamlet.Consistency.html#2402" class="Bound">hp</a> <a id="2405" class="Symbol">=</a> <a id="2407" href="Data.List.Membership.Setoid.html#1495" class="Function">L.Mem.find</a> <a id="2418" href="Protocol.Streamlet.Consistency.html#2327" class="Bound">∃p</a>
    <a id="2425" href="Protocol.Streamlet.Consistency.html#2425" class="Bound">p∈</a> <a id="2428" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2430" href="Protocol.Streamlet.Consistency.html#2430" class="Bound">p∈′</a> <a id="2434" class="Symbol">=</a> <a id="2436" href="Prelude.Lists.html#15563" class="Function">∈-∩⁻</a> <a id="2441" href="Protocol.Streamlet.Consistency.html#2391" class="Bound">p</a> <a id="2443" href="Protocol.Streamlet.Consistency.html#1317" class="Bound">vs</a> <a id="2446" href="Protocol.Streamlet.Consistency.html#1321" class="Bound">vs′</a> <a id="2450" href="Protocol.Streamlet.Consistency.html#2395" class="Bound">p∈vs</a>
  <a id="2457" class="Keyword">in</a>
    <a id="2464" href="Protocol.Streamlet.Consistency.html#2391" class="Bound">p</a> <a id="2466" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2468" href="Protocol.Streamlet.Consistency.html#2402" class="Bound">hp</a> <a id="2471" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2473" href="Protocol.Streamlet.Consistency.html#2425" class="Bound">p∈</a> <a id="2476" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2478" href="Protocol.Streamlet.Consistency.html#2430" class="Bound">p∈′</a>
</pre>
### Unique Notarization per epoch

** Paper statement **
Suppose that f < n/3. Then, for each epoch e,
there can be at most one notarized block for epoch e in honest view.

In honest view, there can only be a unique notarization per epoch.
That is, there cannot be two different notarized blocks for the same epoch.

<pre class="Agda"><a id="2812" class="Comment">-- Lemma 1 (≈ Lemma 10)</a>
<a id="UniqueNotarization"></a><a id="2836" href="Protocol.Streamlet.Consistency.html#2836" class="Function">UniqueNotarization</a> <a id="2855" class="Symbol">:</a> <a id="2857" href="Protocol.Streamlet.Global.Traces.html#966" class="Function">StateProperty</a>
<a id="2871" href="Protocol.Streamlet.Consistency.html#2836" class="Function">UniqueNotarization</a> <a id="2890" href="Protocol.Streamlet.Consistency.html#2890" class="Bound">s</a> <a id="2892" class="Symbol">=</a> <a id="2894" class="Symbol">∀</a> <a id="2896" class="Symbol">{</a><a id="2897" href="Protocol.Streamlet.Consistency.html#2897" class="Bound">p</a> <a id="2899" href="Protocol.Streamlet.Consistency.html#2899" class="Bound">p′</a> <a id="2902" href="Protocol.Streamlet.Consistency.html#2902" class="Bound">b</a> <a id="2904" href="Protocol.Streamlet.Consistency.html#2904" class="Bound">b′</a><a id="2906" class="Symbol">}</a> <a id="2908" class="Symbol">⦃</a> <a id="2910" href="Protocol.Streamlet.Consistency.html#2910" class="Bound">_</a> <a id="2912" class="Symbol">:</a> <a id="2914" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="2921" href="Protocol.Streamlet.Consistency.html#2897" class="Bound">p</a> <a id="2923" class="Symbol">⦄</a> <a id="2925" class="Symbol">⦃</a> <a id="2927" href="Protocol.Streamlet.Consistency.html#2927" class="Bound">_</a> <a id="2929" class="Symbol">:</a> <a id="2931" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="2938" href="Protocol.Streamlet.Consistency.html#2899" class="Bound">p′</a> <a id="2941" class="Symbol">⦄</a> <a id="2943" class="Symbol">→</a>
  <a id="2947" class="Keyword">let</a> <a id="2951" href="Protocol.Streamlet.Consistency.html#2951" class="Bound">ms</a> <a id="2954" class="Symbol">=</a> <a id="2956" class="Symbol">(</a><a id="2957" href="Protocol.Streamlet.Consistency.html#2890" class="Bound">s</a> <a id="2959" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="2961" href="Protocol.Streamlet.Consistency.html#2897" class="Bound">p</a><a id="2962" class="Symbol">)</a> <a id="2964" class="Symbol">.</a><a id="2965" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a> <a id="2968" class="Symbol">;</a> <a id="2970" href="Protocol.Streamlet.Consistency.html#2970" class="Bound">ms′</a> <a id="2974" class="Symbol">=</a> <a id="2976" class="Symbol">(</a><a id="2977" href="Protocol.Streamlet.Consistency.html#2890" class="Bound">s</a> <a id="2979" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="2981" href="Protocol.Streamlet.Consistency.html#2899" class="Bound">p′</a><a id="2983" class="Symbol">)</a> <a id="2985" class="Symbol">.</a><a id="2986" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a> <a id="2989" class="Keyword">in</a>
  <a id="2994" href="Prelude.InferenceRules.html#56097" class="Function Operator">∙</a> <a id="2996" href="Protocol.Streamlet.Local.State.html#3174" class="Record">NotarizedBlock</a> <a id="3011" href="Protocol.Streamlet.Consistency.html#2951" class="Bound">ms</a> <a id="3014" href="Protocol.Streamlet.Consistency.html#2902" class="Bound">b</a>
  <a id="3018" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="3020" href="Protocol.Streamlet.Local.State.html#3174" class="Record">NotarizedBlock</a> <a id="3035" href="Protocol.Streamlet.Consistency.html#2970" class="Bound">ms′</a> <a id="3039" href="Protocol.Streamlet.Consistency.html#2904" class="Bound">b′</a>
  <a id="3044" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="3046" href="Protocol.Streamlet.Consistency.html#2902" class="Bound">b</a> <a id="3048" class="Symbol">.</a><a id="3049" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a> <a id="3055" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3057" href="Protocol.Streamlet.Consistency.html#2904" class="Bound">b′</a> <a id="3060" class="Symbol">.</a><a id="3061" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a>
    <a id="3071" href="Prelude.InferenceRules.html#14094" class="Function Operator">────────────────────</a>
    <a id="3096" href="Protocol.Streamlet.Consistency.html#2902" class="Bound">b</a> <a id="3098" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3100" href="Protocol.Streamlet.Consistency.html#2904" class="Bound">b′</a>
</pre>
** Proof **
Suppose that two blocks B and B′, both of epoch e, are notarized in honest view.
It must be that at least 2n/3 nodes, denoted the set S, signed the block B, and
at least 2n/3 nodes, denoted the set S′, signed the block B′.
Since there are only n nodes in total, S ∩ S′ must have size at least n/3, and thus
at least one honest node is in S ∩ S′. According to our protocol, every honest node
votes for at most one block per epoch. This means that B = B′. ∎

<pre class="Agda"><a id="uniqueNotarization"></a><a id="3585" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="3604" class="Symbol">:</a> <a id="3606" href="Prelude.Closures.html#3717" class="Function">Invariant</a> <a id="3616" href="Protocol.Streamlet.Consistency.html#2836" class="Function">UniqueNotarization</a>
<a id="3635" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="3654" class="Symbol">(_</a> <a id="3657" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3659" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="3664" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3666" class="Symbol">(_</a> <a id="3669" href="Prelude.Closures.html#689" class="InductiveConstructor Operator">∎</a><a id="3670" class="Symbol">))</a> <a id="3673" class="Symbol">{</a><a id="3674" href="Protocol.Streamlet.Consistency.html#3674" class="Bound">p</a><a id="3675" class="Symbol">}</a> <a id="3677" class="Symbol">{</a><a id="3678" href="Protocol.Streamlet.Consistency.html#3678" class="Bound">b</a><a id="3679" class="Symbol">}</a> <a id="3681" class="Symbol">{</a><a id="3682" href="Protocol.Streamlet.Consistency.html#3682" class="Bound">b′</a><a id="3684" class="Symbol">}</a> <a id="3686" href="Protocol.Streamlet.Consistency.html#3686" class="Bound">nb</a> <a id="3689" href="Protocol.Streamlet.Consistency.html#3689" class="Bound">nb′</a> <a id="3693" href="Protocol.Streamlet.Consistency.html#3693" class="Bound">e≡</a>
  <a id="3698" class="Keyword">rewrite</a> <a id="3706" class="Keyword">let</a> <a id="3710" class="Keyword">open</a> <a id="3715" href="Protocol.Streamlet.Global.Step.html#3796" class="Module">∣Base∣</a> <a id="3722" href="Protocol.Streamlet.Consistency.html#3674" class="Bound">p</a> <a id="3724" class="Keyword">in</a> <a id="3727" href="Protocol.Streamlet.Global.Step.html#3830" class="Function">lookup✓</a>
  <a id="3737" class="Symbol">=</a> <a id="3739" href="Data.Empty.html#1050" class="Function">⊥-elim</a> <a id="3746" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3748" href="Data.Nat.Properties.html#8000" class="Function">Nat.1+n≰n</a> <a id="3758" class="Symbol">(</a><a id="3759" href="Protocol.Streamlet.Local.State.html#3363" class="Function">votesNonempty</a> <a id="3773" href="Protocol.Streamlet.Consistency.html#3686" class="Bound">nb</a><a id="3775" class="Symbol">)</a>
<a id="3777" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="3796" href="Protocol.Streamlet.Consistency.html#3796" class="Bound">Rs′</a><a id="3799" class="Symbol">@(_</a> <a id="3803" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3805" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="3810" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3812" class="Symbol">(</a><a id="3813" href="Protocol.Streamlet.Consistency.html#3813" class="Bound">s′</a> <a id="3816" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟨</a> <a id="3818" class="Symbol">_</a> <a id="3820" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟩←—</a> <a id="3824" class="Symbol">_))</a> <a id="3828" class="Symbol">{</a><a id="3829" href="Protocol.Streamlet.Consistency.html#3829" class="Bound">p</a><a id="3830" class="Symbol">}</a> <a id="3832" class="Symbol">{</a><a id="3833" href="Protocol.Streamlet.Consistency.html#3833" class="Bound">p′</a><a id="3835" class="Symbol">}</a> <a id="3837" class="Symbol">{</a><a id="3838" href="Protocol.Streamlet.Consistency.html#3838" class="Bound">b</a><a id="3839" class="Symbol">}</a> <a id="3841" class="Symbol">{</a><a id="3842" href="Protocol.Streamlet.Consistency.html#3842" class="Bound">b′</a><a id="3844" class="Symbol">}</a> <a id="3846" href="Protocol.Streamlet.Consistency.html#3846" class="Bound">nb</a> <a id="3849" href="Protocol.Streamlet.Consistency.html#3849" class="Bound">nb′</a> <a id="3853" href="Protocol.Streamlet.Consistency.html#3853" class="Bound">e≡</a>
    <a id="3860" class="Keyword">with</a> <a id="3865" href="Protocol.Streamlet.Consistency.html#3838" class="Bound">b</a> <a id="3867" href="Prelude.DecEq.html#123" class="Field Operator">≟</a> <a id="3869" href="Protocol.Streamlet.Consistency.html#3842" class="Bound">b′</a>
<a id="3872" class="Symbol">...</a> <a id="3876" class="Symbol">|</a> <a id="3878" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="3882" href="Protocol.Streamlet.Consistency.html#3882" class="Bound">b≡</a> <a id="3885" class="Symbol">=</a> <a id="3887" href="Protocol.Streamlet.Consistency.html#3882" class="Bound">b≡</a>
<a id="3890" class="Symbol">...</a> <a id="3894" class="Symbol">|</a> <a id="3896" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="3900" href="Protocol.Streamlet.Consistency.html#3900" class="Bound">b≢</a> <a id="3903" class="Symbol">=</a> <a id="3905" href="Data.Empty.html#1050" class="Function">⊥-elim</a> <a id="3912" href="Protocol.Streamlet.Consistency.html#3932" class="Function">QED</a>
    <a id="3920" class="Keyword">where</a>
      <a id="3932" href="Protocol.Streamlet.Consistency.html#3932" class="Function">QED</a> <a id="3936" class="Symbol">:</a> <a id="3938" href="Data.Empty.html#895" class="Function">⊥</a>
      <a id="3946" href="Protocol.Streamlet.Consistency.html#3932" class="Function">QED</a> <a id="3950" class="Symbol">=</a>
        <a id="3960" class="Keyword">let</a>
          <a id="3974" href="Protocol.Streamlet.Consistency.html#3974" class="Bound">ms</a> <a id="3977" class="Symbol">=</a> <a id="3979" class="Symbol">(</a><a id="3980" class="Bound">s′</a> <a id="3983" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="3985" class="Bound">p</a><a id="3986" class="Symbol">)</a> <a id="3988" class="Symbol">.</a><a id="3989" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
          <a id="4002" href="Protocol.Streamlet.Consistency.html#4002" class="Bound">ms′</a> <a id="4006" class="Symbol">=</a> <a id="4008" class="Symbol">(</a><a id="4009" class="Bound">s′</a> <a id="4012" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="4014" class="Bound">p′</a><a id="4016" class="Symbol">)</a> <a id="4018" class="Symbol">.</a><a id="4019" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>

          <a id="4033" href="Protocol.Streamlet.Consistency.html#4033" class="Bound">vs</a>  <a id="4037" class="Symbol">=</a> <a id="4039" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="4047" href="Protocol.Streamlet.Consistency.html#3974" class="Bound">ms</a> <a id="4050" class="Bound">b</a>
          <a id="4062" href="Protocol.Streamlet.Consistency.html#4062" class="Bound">vs′</a> <a id="4066" class="Symbol">=</a> <a id="4068" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="4076" href="Protocol.Streamlet.Consistency.html#4002" class="Bound">ms′</a> <a id="4080" class="Bound">b′</a>

          <a id="4094" href="Protocol.Streamlet.Consistency.html#4094" class="Bound">uvs</a> <a id="4098" class="Symbol">:</a> <a id="4100" class="Symbol">∀</a> <a id="4102" class="Symbol">{</a><a id="4103" href="Protocol.Streamlet.Consistency.html#4103" class="Bound">b</a><a id="4104" class="Symbol">}</a> <a id="4106" class="Symbol">→</a> <a id="4108" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="4115" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4117" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="4125" href="Protocol.Streamlet.Consistency.html#3974" class="Bound">ms</a> <a id="4128" href="Protocol.Streamlet.Consistency.html#4103" class="Bound">b</a>
          <a id="4140" href="Protocol.Streamlet.Consistency.html#4094" class="Bound">uvs</a> <a id="4144" class="Symbol">{</a><a id="4145" href="Protocol.Streamlet.Consistency.html#4145" class="Bound">b</a><a id="4146" class="Symbol">}</a> <a id="4148" class="Symbol">=</a> <a id="4150" href="Protocol.Streamlet.Invariants.Uniqueness.html#2887" class="Function">uniqueVoteIds</a> <a id="4164" class="Bound">Rs′</a>

          <a id="4179" href="Protocol.Streamlet.Consistency.html#4179" class="Bound">uvs′</a> <a id="4184" class="Symbol">:</a> <a id="4186" class="Symbol">∀</a> <a id="4188" class="Symbol">{</a><a id="4189" href="Protocol.Streamlet.Consistency.html#4189" class="Bound">b</a><a id="4190" class="Symbol">}</a> <a id="4192" class="Symbol">→</a> <a id="4194" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="4201" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4203" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="4211" href="Protocol.Streamlet.Consistency.html#4002" class="Bound">ms′</a> <a id="4215" href="Protocol.Streamlet.Consistency.html#4189" class="Bound">b</a>
          <a id="4227" href="Protocol.Streamlet.Consistency.html#4179" class="Bound">uvs′</a> <a id="4232" class="Symbol">{</a><a id="4233" href="Protocol.Streamlet.Consistency.html#4233" class="Bound">b</a><a id="4234" class="Symbol">}</a> <a id="4236" class="Symbol">=</a> <a id="4238" href="Protocol.Streamlet.Invariants.Uniqueness.html#2887" class="Function">uniqueVoteIds</a> <a id="4252" class="Bound">Rs′</a>

          <a id="4267" href="Protocol.Streamlet.Consistency.html#4267" class="Bound">mvs</a>  <a id="4272" class="Symbol">:</a> <a id="4274" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="4285" href="Protocol.Streamlet.Consistency.html#4033" class="Bound">vs</a>
          <a id="4298" href="Protocol.Streamlet.Consistency.html#4267" class="Bound">mvs</a>  <a id="4303" class="Symbol">=</a> <a id="4305" href="Protocol.Streamlet.Local.State.html#3254" class="Function">enoughVoteIds</a> <a id="4319" class="Bound">nb</a>

          <a id="4333" href="Protocol.Streamlet.Consistency.html#4333" class="Bound">mvs′</a> <a id="4338" class="Symbol">:</a> <a id="4340" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="4351" href="Protocol.Streamlet.Consistency.html#4062" class="Bound">vs′</a>
          <a id="4365" href="Protocol.Streamlet.Consistency.html#4333" class="Bound">mvs′</a> <a id="4370" class="Symbol">=</a> <a id="4372" href="Protocol.Streamlet.Local.State.html#3254" class="Function">enoughVoteIds</a> <a id="4386" class="Bound">nb′</a>

          <a id="4401" href="Protocol.Streamlet.Consistency.html#4401" class="Bound">p″</a> <a id="4404" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4406" href="Protocol.Streamlet.Consistency.html#4406" class="Bound">hp″</a> <a id="4410" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4412" href="Protocol.Streamlet.Consistency.html#4412" class="Bound">p∈</a> <a id="4415" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4417" href="Protocol.Streamlet.Consistency.html#4417" class="Bound">p∈′</a> <a id="4421" class="Symbol">=</a> <a id="4423" href="Protocol.Streamlet.Consistency.html#1092" class="Function">honest-intersection</a> <a id="4443" href="Protocol.Streamlet.Consistency.html#4094" class="Bound">uvs</a> <a id="4447" href="Protocol.Streamlet.Consistency.html#4179" class="Bound">uvs′</a> <a id="4452" href="Protocol.Streamlet.Consistency.html#4267" class="Bound">mvs</a> <a id="4456" href="Protocol.Streamlet.Consistency.html#4333" class="Bound">mvs′</a>
          <a id="4471" class="Keyword">instance</a> <a id="4480" href="Protocol.Streamlet.Consistency.html#4480" class="Bound">_</a> <a id="4482" class="Symbol">=</a> <a id="4484" href="Protocol.Streamlet.Consistency.html#4406" class="Bound">hp″</a>

          <a id="4499" href="Protocol.Streamlet.Consistency.html#4499" class="Bound">b≡</a> <a id="4502" class="Symbol">:</a> <a id="4504" class="Bound">b</a> <a id="4506" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4508" class="Bound">b′</a>
          <a id="4521" href="Protocol.Streamlet.Consistency.html#4499" class="Bound">b≡</a> <a id="4524" class="Symbol">=</a> <a id="4526" href="Protocol.Streamlet.Invariants.VotedOnlyOnce.html#5322" class="Function">votedOnlyOncePerEpoch</a> <a id="4548" class="Bound">Rs′</a> <a id="4552" class="Symbol">(</a><a id="4553" href="Protocol.Streamlet.Invariants.Votes.html#1250" class="Function">messageSharing</a> <a id="4568" class="Bound">Rs′</a> <a id="4572" href="Protocol.Streamlet.Consistency.html#4412" class="Bound">p∈</a><a id="4574" class="Symbol">)</a> <a id="4576" class="Symbol">(</a><a id="4577" href="Protocol.Streamlet.Invariants.Votes.html#1250" class="Function">messageSharing</a> <a id="4592" class="Bound">Rs′</a> <a id="4596" href="Protocol.Streamlet.Consistency.html#4417" class="Bound">p∈′</a><a id="4599" class="Symbol">)</a> <a id="4601" class="Bound">e≡</a>
        <a id="4612" class="Keyword">in</a>
          <a id="4625" href="Protocol.Streamlet.Consistency.html#3900" class="Bound">b≢</a> <a id="4628" href="Protocol.Streamlet.Consistency.html#4499" class="Bound">b≡</a>
</pre>
### Main Consistency Lemma

** Paper statement **
If some honest node sees a notarized chain with three adjacent blocks B0 , B1 , B2
with consecutive epoch numbers e, e + 1, and e + 2,
then there cannot be a conflicting block B ≠ B1 that also gets notarized
in honest view at the same length as B1.
ADDENDUM: B derives its length from its parent chain (assuming a valid chain sequence)

<pre class="Agda"><a id="5031" class="Comment">-- Lemma 2 (≈ Lemma 14)</a>
<a id="ConsistencyLemma"></a><a id="5055" href="Protocol.Streamlet.Consistency.html#5055" class="Function">ConsistencyLemma</a> <a id="5072" class="Symbol">:</a> <a id="5074" href="Protocol.Streamlet.Global.Traces.html#966" class="Function">StateProperty</a>
<a id="5088" href="Protocol.Streamlet.Consistency.html#5055" class="Function">ConsistencyLemma</a> <a id="5105" href="Protocol.Streamlet.Consistency.html#5105" class="Bound">s</a> <a id="5107" class="Symbol">=</a> <a id="5109" class="Symbol">∀</a> <a id="5111" class="Symbol">{</a><a id="5112" href="Protocol.Streamlet.Consistency.html#5112" class="Bound">p</a> <a id="5114" href="Protocol.Streamlet.Consistency.html#5114" class="Bound">p′</a> <a id="5117" href="Protocol.Streamlet.Consistency.html#5117" class="Bound">b</a> <a id="5119" href="Protocol.Streamlet.Consistency.html#5119" class="Bound">b′</a> <a id="5122" href="Protocol.Streamlet.Consistency.html#5122" class="Bound">b″</a> <a id="5125" href="Protocol.Streamlet.Consistency.html#5125" class="Bound">ch</a> <a id="5128" href="Protocol.Streamlet.Consistency.html#5128" class="Bound">ch′</a><a id="5131" class="Symbol">}</a> <a id="5133" class="Symbol">⦃</a> <a id="5135" href="Protocol.Streamlet.Consistency.html#5135" class="Bound">_</a> <a id="5137" class="Symbol">:</a> <a id="5139" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="5146" href="Protocol.Streamlet.Consistency.html#5112" class="Bound">p</a> <a id="5148" class="Symbol">⦄</a> <a id="5150" class="Symbol">⦃</a> <a id="5152" href="Protocol.Streamlet.Consistency.html#5152" class="Bound">_</a> <a id="5154" class="Symbol">:</a> <a id="5156" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="5163" href="Protocol.Streamlet.Consistency.html#5114" class="Bound">p′</a> <a id="5166" class="Symbol">⦄</a> <a id="5168" class="Symbol">→</a>
  <a id="5172" class="Keyword">let</a>
    <a id="5180" href="Protocol.Streamlet.Consistency.html#5180" class="Bound">ms</a>  <a id="5184" class="Symbol">=</a> <a id="5186" class="Symbol">(</a><a id="5187" href="Protocol.Streamlet.Consistency.html#5105" class="Bound">s</a> <a id="5189" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="5191" href="Protocol.Streamlet.Consistency.html#5112" class="Bound">p</a><a id="5192" class="Symbol">)</a>  <a id="5195" class="Symbol">.</a><a id="5196" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
    <a id="5203" href="Protocol.Streamlet.Consistency.html#5203" class="Bound">ms′</a> <a id="5207" class="Symbol">=</a> <a id="5209" class="Symbol">(</a><a id="5210" href="Protocol.Streamlet.Consistency.html#5105" class="Bound">s</a> <a id="5212" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="5214" href="Protocol.Streamlet.Consistency.html#5114" class="Bound">p′</a><a id="5216" class="Symbol">)</a> <a id="5218" class="Symbol">.</a><a id="5219" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
  <a id="5224" class="Keyword">in</a>
  <a id="5229" href="Prelude.InferenceRules.html#56097" class="Function Operator">∙</a> <a id="5231" class="Symbol">(</a><a id="5232" href="Protocol.Streamlet.Consistency.html#5122" class="Bound">b″</a> <a id="5235" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5237" href="Protocol.Streamlet.Consistency.html#5117" class="Bound">b</a> <a id="5239" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5241" href="Protocol.Streamlet.Consistency.html#5125" class="Bound">ch</a><a id="5243" class="Symbol">)</a> <a id="5245" href="Protocol.Streamlet.Local.State.html#1652" class="Datatype Operator">chain-∈</a> <a id="5253" href="Protocol.Streamlet.Consistency.html#5180" class="Bound">ms</a>
  <a id="5258" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="5260" href="Protocol.Streamlet.Local.State.html#3689" class="Datatype">FinalizedChain</a> <a id="5275" href="Protocol.Streamlet.Consistency.html#5180" class="Bound">ms</a> <a id="5278" class="Symbol">(</a><a id="5279" href="Protocol.Streamlet.Consistency.html#5117" class="Bound">b</a> <a id="5281" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5283" href="Protocol.Streamlet.Consistency.html#5125" class="Bound">ch</a><a id="5285" class="Symbol">)</a> <a id="5287" href="Protocol.Streamlet.Consistency.html#5122" class="Bound">b″</a>

  <a id="5293" class="Comment">-- NB: this is actually sufficient</a>
  <a id="5330" class="Comment">-- ∙ (b′ ∷ ch′) chain-∈ ms</a>
  <a id="5359" class="Comment">-- ∙ NotarizedBlock (ls .db) b′</a>

  <a id="5394" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="5396" class="Symbol">(</a><a id="5397" href="Protocol.Streamlet.Consistency.html#5119" class="Bound">b′</a> <a id="5400" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5402" href="Protocol.Streamlet.Consistency.html#5128" class="Bound">ch′</a><a id="5405" class="Symbol">)</a> <a id="5407" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="5425" href="Protocol.Streamlet.Consistency.html#5203" class="Bound">ms′</a>
  <a id="5431" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="5433" href="Data.List.Base.html#5083" class="Function">length</a> <a id="5440" href="Protocol.Streamlet.Consistency.html#5128" class="Bound">ch′</a> <a id="5444" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5446" href="Data.List.Base.html#5083" class="Function">length</a> <a id="5453" href="Protocol.Streamlet.Consistency.html#5125" class="Bound">ch</a>
    <a id="5460" href="Prelude.InferenceRules.html#13789" class="Function Operator">──────────────────────────────</a>
    <a id="5495" href="Protocol.Streamlet.Consistency.html#5117" class="Bound">b</a> <a id="5497" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5499" href="Protocol.Streamlet.Consistency.html#5119" class="Bound">b′</a>
</pre>
** Paper proof **
Essentially the same as the argument above, but with generalized parameters rather than
6, 7, and 8. We defer the proof to the Appendix, in Section B Lemma 14.

<pre class="Agda"><a id="consistencyLemma"></a><a id="5694" href="Protocol.Streamlet.Consistency.html#5694" class="Function">consistencyLemma</a> <a id="5711" class="Symbol">:</a> <a id="5713" href="Prelude.Closures.html#3717" class="Function">Invariant</a> <a id="5723" href="Protocol.Streamlet.Consistency.html#5055" class="Function">ConsistencyLemma</a>
<a id="5740" href="Protocol.Streamlet.Consistency.html#5694" class="Function">consistencyLemma</a> <a id="5757" class="Symbol">(_</a> <a id="5760" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5762" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="5767" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5769" class="Symbol">(_</a> <a id="5772" href="Prelude.Closures.html#689" class="InductiveConstructor Operator">∎</a><a id="5773" class="Symbol">))</a> <a id="5776" class="Symbol">{</a><a id="5777" href="Protocol.Streamlet.Consistency.html#5777" class="Bound">p</a><a id="5778" class="Symbol">}</a> <a id="5780" class="Symbol">(</a><a id="5781" href="Protocol.Streamlet.Consistency.html#5781" class="Bound">m∈</a> <a id="5784" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="5786" class="Symbol">_</a> <a id="5788" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="5790" class="Symbol">_)</a> <a id="5793" class="Symbol">_</a> <a id="5795" class="Symbol">_</a> <a id="5797" class="Symbol">_</a>
  <a id="5801" class="Keyword">rewrite</a> <a id="5809" class="Keyword">let</a> <a id="5813" class="Keyword">open</a> <a id="5818" href="Protocol.Streamlet.Global.Step.html#3796" class="Module">∣Base∣</a> <a id="5825" href="Protocol.Streamlet.Consistency.html#5777" class="Bound">p</a> <a id="5827" class="Keyword">in</a> <a id="5830" href="Protocol.Streamlet.Global.Step.html#3830" class="Function">lookup✓</a>
  <a id="5840" class="Symbol">=</a> <a id="5842" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="5847" href="Protocol.Streamlet.Consistency.html#5781" class="Bound">m∈</a> <a id="5850" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="5853" class="Symbol">λ</a> <a id="5855" class="Symbol">()</a>
<a id="5858" href="Protocol.Streamlet.Consistency.html#5694" class="Function">consistencyLemma</a> <a id="5875" href="Protocol.Streamlet.Consistency.html#5875" class="Bound">Rs</a><a id="5877" class="Symbol">@(_</a> <a id="5881" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5883" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="5888" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5890" class="Symbol">(</a><a id="5891" href="Protocol.Streamlet.Consistency.html#5891" class="Bound">s</a> <a id="5893" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟨</a> <a id="5895" class="Symbol">_</a> <a id="5897" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟩←—</a> <a id="5901" class="Symbol">_))</a> <a id="5905" class="Symbol">{</a><a id="5906" href="Protocol.Streamlet.Consistency.html#5906" class="Bound">p</a><a id="5907" class="Symbol">}</a> <a id="5909" class="Symbol">{</a><a id="5910" href="Protocol.Streamlet.Consistency.html#5910" class="Bound">p′</a><a id="5912" class="Symbol">}</a> <a id="5914" class="Symbol">{</a><a id="5915" href="Protocol.Streamlet.Consistency.html#5915" class="Bound">B₁</a><a id="5917" class="Symbol">}</a> <a id="5919" class="Symbol">{</a><a id="5920" href="Protocol.Streamlet.Consistency.html#5920" class="Bound">B</a><a id="5921" class="Symbol">}</a> <a id="5923" class="Symbol">{</a><a id="5924" href="Protocol.Streamlet.Consistency.html#5924" class="Bound">B₂</a><a id="5926" class="Symbol">}</a> <a id="5928" class="Symbol">{</a><a id="5929" href="Protocol.Streamlet.Consistency.html#5929" class="Bound">ch</a><a id="5931" class="Symbol">@(</a><a id="5933" href="Protocol.Streamlet.Consistency.html#5933" class="Bound">B₀</a> <a id="5936" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5938" href="Protocol.Streamlet.Consistency.html#5938" class="Bound">ch₀</a><a id="5941" class="Symbol">)}</a> <a id="5944" class="Symbol">{</a><a id="5945" href="Protocol.Streamlet.Consistency.html#5945" class="Bound">ch′</a><a id="5948" class="Symbol">}</a>
  <a id="5952" href="Protocol.Streamlet.Consistency.html#5952" class="Bound">ch∈</a><a id="5955" class="Symbol">@(_</a> <a id="5959" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="5961" href="Protocol.Streamlet.Consistency.html#5961" class="Bound">ch₁∈</a><a id="5965" class="Symbol">@(_</a> <a id="5969" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="5971" class="Symbol">(_</a> <a id="5974" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="5976" class="Symbol">_</a> <a id="5978" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="5980" href="Protocol.Streamlet.Consistency.html#5980" class="Bound">B₀connects</a><a id="5990" class="Symbol">)</a> <a id="5992" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="5994" class="Symbol">_)</a> <a id="5997" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="5999" href="Protocol.Streamlet.Consistency.html#5999" class="Bound">B₂connects</a><a id="6009" class="Symbol">)</a>
  <a id="6013" href="Protocol.Streamlet.Consistency.html#6013" class="Bound">fch</a><a id="6016" class="Symbol">@(</a><a id="6018" href="Protocol.Streamlet.Local.State.html#3737" class="InductiveConstructor">Finalize</a> <a id="6027" href="Protocol.Streamlet.Consistency.html#6027" class="Bound">nch</a><a id="6030" class="Symbol">@(</a><a id="6032" href="Protocol.Streamlet.Consistency.html#6032" class="Bound">nB₂</a> <a id="6036" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="6038" href="Protocol.Streamlet.Consistency.html#6038" class="Bound">nB₁</a> <a id="6042" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="6044" href="Protocol.Streamlet.Consistency.html#6044" class="Bound">nB₀</a> <a id="6048" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="6050" class="Symbol">_)</a> <a id="6053" href="Protocol.Streamlet.Consistency.html#6053" class="Bound">e₂≡</a> <a id="6057" href="Protocol.Streamlet.Consistency.html#6057" class="Bound">e₁≡</a><a id="6060" class="Symbol">)</a>
  <a id="6064" href="Protocol.Streamlet.Consistency.html#6064" class="Bound">nc∈′</a><a id="6068" class="Symbol">@(</a><a id="6070" href="Protocol.Streamlet.Consistency.html#6070" class="Bound">ch∈′</a><a id="6074" class="Symbol">@(</a><a id="6076" href="Protocol.Streamlet.Consistency.html#6076" class="Bound">B∈</a> <a id="6079" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="6081" href="Protocol.Streamlet.Consistency.html#6081" class="Bound">ch′∈</a> <a id="6086" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="6088" href="Protocol.Streamlet.Consistency.html#6088" class="Bound">Bconnects</a><a id="6097" class="Symbol">)</a> <a id="6099" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6101" class="Symbol">(</a><a id="6102" href="Protocol.Streamlet.Consistency.html#6102" class="Bound">nB</a> <a id="6105" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="6107" class="Symbol">_))</a>
  <a id="6113" href="Protocol.Streamlet.Consistency.html#6113" class="Bound">len≡</a>
  <a id="6120" class="Keyword">with</a> <a id="6125" href="Protocol.Streamlet.Consistency.html#5915" class="Bound">B₁</a> <a id="6128" href="Prelude.DecEq.html#123" class="Field Operator">≟</a> <a id="6130" href="Protocol.Streamlet.Consistency.html#5920" class="Bound">B</a>
<a id="6132" class="Symbol">...</a> <a id="6136" class="Symbol">|</a> <a id="6138" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="6142" href="Protocol.Streamlet.Consistency.html#6142" class="Bound">B₁≡B</a> <a id="6147" class="Symbol">=</a> <a id="6149" href="Protocol.Streamlet.Consistency.html#6142" class="Bound">B₁≡B</a>
<a id="6154" class="Symbol">...</a> <a id="6158" class="Symbol">|</a> <a id="6160" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="6164" href="Protocol.Streamlet.Consistency.html#6164" class="Bound">B₁≢B</a> <a id="6169" class="Symbol">=</a> <a id="6171" href="Data.Empty.html#1050" class="Function">⊥-elim</a> <a id="6178" href="Protocol.Streamlet.Consistency.html#7962" class="Function">QED</a>
  <a id="6184" class="Keyword">where</a>
  <a id="6192" class="Keyword">open</a> <a id="6197" href="Prelude.Init.html#1344" class="Module">Nat</a>
  <a id="6203" class="Comment">-- * messages</a>
  <a id="6219" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a>  <a id="6223" class="Symbol">=</a> <a id="6225" class="Symbol">(</a><a id="6226" class="Bound">s</a> <a id="6228" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="6230" class="Bound">p</a><a id="6231" class="Symbol">)</a> <a id="6233" class="Symbol">.</a><a id="6234" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
  <a id="6239" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="6243" class="Symbol">=</a> <a id="6245" class="Symbol">(</a><a id="6246" class="Bound">s</a> <a id="6248" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="6250" class="Bound">p′</a><a id="6252" class="Symbol">)</a> <a id="6254" class="Symbol">.</a><a id="6255" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>

  <a id="6261" class="Comment">-- * epochs</a>
  <a id="6275" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a> <a id="6278" class="Symbol">=</a> <a id="6280" class="Bound">B</a>  <a id="6283" class="Symbol">.</a><a id="6284" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a>
  <a id="6292" href="Protocol.Streamlet.Consistency.html#6292" class="Function">e₀</a> <a id="6295" class="Symbol">=</a> <a id="6297" class="Bound">B₀</a> <a id="6300" class="Symbol">.</a><a id="6301" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a>
  <a id="6309" href="Protocol.Streamlet.Consistency.html#6309" class="Function">e₁</a> <a id="6312" class="Symbol">=</a> <a id="6314" class="Bound">B₁</a> <a id="6317" class="Symbol">.</a><a id="6318" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a>
  <a id="6326" href="Protocol.Streamlet.Consistency.html#6326" class="Function">e₂</a> <a id="6329" class="Symbol">=</a> <a id="6331" class="Bound">B₂</a> <a id="6334" class="Symbol">.</a><a id="6335" href="Protocol.Streamlet.Block.html#332" class="Field">epoch</a>

  <a id="6344" class="Comment">-- * lengths</a>
  <a id="6359" href="Protocol.Streamlet.Consistency.html#6359" class="Function">ch₁</a> <a id="6363" class="Symbol">=</a> <a id="6365" class="Bound">B₁</a> <a id="6368" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6370" class="Bound">ch</a>
  <a id="6375" href="Protocol.Streamlet.Consistency.html#6375" class="Function">ch₂</a> <a id="6379" class="Symbol">=</a> <a id="6381" class="Bound">B₂</a> <a id="6384" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6386" href="Protocol.Streamlet.Consistency.html#6359" class="Function">ch₁</a>

  <a id="6393" href="Protocol.Streamlet.Consistency.html#6393" class="Function">ℓ-1</a> <a id="6397" class="Symbol">=</a> <a id="6399" href="Data.List.Base.html#5083" class="Function">length</a> <a id="6406" class="Bound">ch₀</a>
  <a id="6412" href="Protocol.Streamlet.Consistency.html#6412" class="Function">ℓ</a>   <a id="6416" class="Symbol">=</a> <a id="6418" href="Data.List.Base.html#5083" class="Function">length</a> <a id="6425" class="Bound">ch</a>
  <a id="6430" href="Protocol.Streamlet.Consistency.html#6430" class="Function">ℓ+1</a> <a id="6434" class="Symbol">=</a> <a id="6436" href="Data.List.Base.html#5083" class="Function">length</a> <a id="6443" href="Protocol.Streamlet.Consistency.html#6359" class="Function">ch₁</a>
  <a id="6449" href="Protocol.Streamlet.Consistency.html#6449" class="Function">ℓ+2</a> <a id="6453" class="Symbol">=</a> <a id="6455" href="Data.List.Base.html#5083" class="Function">length</a> <a id="6462" href="Protocol.Streamlet.Consistency.html#6375" class="Function">ch₂</a>
  <a id="6468" href="Protocol.Streamlet.Consistency.html#6468" class="Function">ℓᴮ</a>  <a id="6472" class="Symbol">=</a> <a id="6474" href="Data.List.Base.html#5083" class="Function">length</a> <a id="6481" class="Symbol">(</a><a id="6482" class="Bound">B</a> <a id="6484" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6486" class="Bound">ch′</a><a id="6489" class="Symbol">)</a>

  <a id="6494" href="Protocol.Streamlet.Consistency.html#6494" class="Function">ℓᴮ≡</a> <a id="6498" class="Symbol">:</a> <a id="6500" href="Protocol.Streamlet.Consistency.html#6468" class="Function">ℓᴮ</a> <a id="6503" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6505" href="Protocol.Streamlet.Consistency.html#6430" class="Function">ℓ+1</a>
  <a id="6511" href="Protocol.Streamlet.Consistency.html#6494" class="Function">ℓᴮ≡</a> <a id="6515" class="Symbol">=</a> <a id="6517" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="6522" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6526" class="Bound">len≡</a>

  <a id="6534" class="Comment">-- * validity</a>
  <a id="6550" href="Protocol.Streamlet.Consistency.html#6550" class="Function">vch₂</a> <a id="6555" class="Symbol">:</a> <a id="6557" href="Protocol.Streamlet.Local.Chain.html#1198" class="Datatype">ValidChain</a> <a id="6568" href="Protocol.Streamlet.Consistency.html#6375" class="Function">ch₂</a>
  <a id="6574" href="Protocol.Streamlet.Consistency.html#6550" class="Function">vch₂</a> <a id="6579" class="Symbol">=</a> <a id="6581" href="Protocol.Streamlet.Local.State.html#1944" class="Function">chain-∈⇒Valid</a> <a id="6595" class="Bound">ch∈</a>

  <a id="6602" href="Protocol.Streamlet.Consistency.html#6602" class="Function">vch</a> <a id="6606" class="Symbol">:</a> <a id="6608" href="Protocol.Streamlet.Local.Chain.html#1198" class="Datatype">ValidChain</a> <a id="6619" class="Bound">ch</a>
  <a id="6624" href="Protocol.Streamlet.Consistency.html#6602" class="Function">vch</a> <a id="6628" class="Symbol">=</a> <a id="6630" href="Protocol.Streamlet.Local.Chain.html#1497" class="Function">uncons-vc</a> <a id="6640" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6642" href="Protocol.Streamlet.Local.Chain.html#1497" class="Function">uncons-vc</a> <a id="6652" href="Protocol.Streamlet.Consistency.html#6550" class="Function">vch₂</a>

  <a id="6660" href="Protocol.Streamlet.Consistency.html#6660" class="Function">vch′</a> <a id="6665" class="Symbol">:</a> <a id="6667" href="Protocol.Streamlet.Local.Chain.html#1198" class="Datatype">ValidChain</a> <a id="6678" class="Symbol">(</a><a id="6679" class="Bound">B</a> <a id="6681" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6683" class="Bound">ch′</a><a id="6686" class="Symbol">)</a>
  <a id="6690" href="Protocol.Streamlet.Consistency.html#6660" class="Function">vch′</a> <a id="6695" class="Symbol">=</a> <a id="6697" href="Protocol.Streamlet.Local.State.html#1944" class="Function">chain-∈⇒Valid</a> <a id="6711" class="Bound">ch∈′</a>

  <a id="6719" href="Protocol.Streamlet.Consistency.html#6719" class="Function">ch∈₀</a> <a id="6724" class="Symbol">:</a> <a id="6726" class="Bound">ch</a> <a id="6729" href="Protocol.Streamlet.Local.State.html#1652" class="Datatype Operator">chain-∈</a> <a id="6737" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a>
  <a id="6742" href="Protocol.Streamlet.Consistency.html#6719" class="Function">ch∈₀</a> <a id="6747" class="Symbol">=</a> <a id="6749" href="Protocol.Streamlet.Local.State.html#2075" class="Function">uncons-ch∈</a> <a id="6760" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6762" href="Protocol.Streamlet.Local.State.html#2075" class="Function">uncons-ch∈</a> <a id="6773" class="Bound">ch∈</a>

  <a id="6780" href="Protocol.Streamlet.Consistency.html#6780" class="Function">nch∈′</a> <a id="6786" class="Symbol">:</a> <a id="6788" class="Bound">ch′</a> <a id="6792" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="6810" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a>
  <a id="6816" href="Protocol.Streamlet.Consistency.html#6780" class="Function">nch∈′</a> <a id="6822" class="Symbol">=</a> <a id="6824" href="Protocol.Streamlet.Local.State.html#9749" class="Function">notarized-chain-∈-tail</a> <a id="6847" class="Bound">nc∈′</a>

  <a id="6855" href="Protocol.Streamlet.Consistency.html#6855" class="Function">nch∈₁</a> <a id="6861" class="Symbol">:</a> <a id="6863" href="Protocol.Streamlet.Consistency.html#6359" class="Function">ch₁</a> <a id="6867" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="6885" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a>
  <a id="6890" href="Protocol.Streamlet.Consistency.html#6855" class="Function">nch∈₁</a> <a id="6896" class="Symbol">=</a> <a id="6898" class="Bound">ch₁∈</a> <a id="6903" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6905" href="Data.List.Relation.Unary.All.html#2591" class="Function">L.All.tail</a> <a id="6916" class="Bound">nch</a>

  <a id="6923" href="Protocol.Streamlet.Consistency.html#6923" class="Function">nch∈₀</a> <a id="6929" class="Symbol">:</a> <a id="6931" class="Bound">ch₀</a> <a id="6935" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="6953" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a>
  <a id="6958" href="Protocol.Streamlet.Consistency.html#6923" class="Function">nch∈₀</a> <a id="6964" class="Symbol">=</a> <a id="6966" href="Protocol.Streamlet.Local.State.html#9749" class="Function">notarized-chain-∈-tail</a> <a id="6989" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6991" href="Protocol.Streamlet.Local.State.html#9749" class="Function">notarized-chain-∈-tail</a> <a id="7014" href="Protocol.Streamlet.Consistency.html#6855" class="Function">nch∈₁</a>

  <a id="7023" class="Comment">-- B ∉ {B₀, B₁, B₂}</a>
  <a id="7045" href="Protocol.Streamlet.Consistency.html#7045" class="Function">B₀≢B</a> <a id="7050" class="Symbol">:</a> <a id="7052" class="Bound">B₀</a> <a id="7055" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="7057" class="Bound">B</a>
  <a id="7061" href="Protocol.Streamlet.Consistency.html#7045" class="Function">B₀≢B</a> <a id="7066" class="Symbol">=</a> <a id="7068" href="Protocol.Streamlet.Local.Chain.html#2203" class="Function">∣ch∣≢→b≢</a> <a id="7077" href="Protocol.Streamlet.Consistency.html#6602" class="Function">vch</a> <a id="7081" href="Protocol.Streamlet.Consistency.html#6660" class="Function">vch′</a> <a id="7086" class="Symbol">(</a><a id="7087" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="7093" class="Symbol">(_</a> <a id="7096" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢_</a><a id="7098" class="Symbol">)</a> <a id="7100" class="Symbol">(</a><a id="7101" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="7105" class="Bound">len≡</a><a id="7109" class="Symbol">)</a> <a id="7111" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7113" href="Relation.Binary.PropositionalEquality.Core.html#2329" class="Function">Eq.≢-sym</a> <a id="7122" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7124" href="Data.Nat.Properties.html#3889" class="Function">1+n≢n</a><a id="7129" class="Symbol">)</a>
  <a id="7133" href="Protocol.Streamlet.Consistency.html#7133" class="Function">B₂≢B</a> <a id="7138" class="Symbol">:</a> <a id="7140" class="Bound">B₂</a> <a id="7143" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="7145" class="Bound">B</a>
  <a id="7149" href="Protocol.Streamlet.Consistency.html#7133" class="Function">B₂≢B</a> <a id="7154" class="Symbol">=</a> <a id="7156" href="Protocol.Streamlet.Local.Chain.html#2203" class="Function">∣ch∣≢→b≢</a> <a id="7165" class="Symbol">(</a><a id="7166" href="Protocol.Streamlet.Local.State.html#1944" class="Function">chain-∈⇒Valid</a> <a id="7180" class="Bound">ch∈</a><a id="7183" class="Symbol">)</a> <a id="7185" href="Protocol.Streamlet.Consistency.html#6660" class="Function">vch′</a>
       <a id="7197" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7199" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="7205" class="Symbol">(_</a> <a id="7208" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢_</a><a id="7210" class="Symbol">)</a> <a id="7212" class="Symbol">(</a><a id="7213" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="7217" class="Bound">len≡</a><a id="7221" class="Symbol">)</a> <a id="7223" href="Data.Nat.Properties.html#3889" class="Function">1+n≢n</a>

  <a id="7232" class="Comment">-- honest intersection</a>
  <a id="7257" href="Protocol.Streamlet.Consistency.html#7257" class="Function">vsᴮ</a> <a id="7261" href="Protocol.Streamlet.Consistency.html#7261" class="Function">vsᴮ⁰</a> <a id="7266" href="Protocol.Streamlet.Consistency.html#7266" class="Function">vsᴮ²</a> <a id="7271" class="Symbol">:</a> <a id="7273" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7278" href="Protocol.Streamlet.Assumptions.html#512" class="Function">Pid</a>
  <a id="7284" href="Protocol.Streamlet.Consistency.html#7257" class="Function">vsᴮ</a>  <a id="7289" class="Symbol">=</a> <a id="7291" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7299" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="7303" class="Bound">B</a>
  <a id="7307" href="Protocol.Streamlet.Consistency.html#7261" class="Function">vsᴮ⁰</a> <a id="7312" class="Symbol">=</a> <a id="7314" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7322" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a> <a id="7325" class="Bound">B₀</a>
  <a id="7330" href="Protocol.Streamlet.Consistency.html#7266" class="Function">vsᴮ²</a> <a id="7335" class="Symbol">=</a> <a id="7337" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7345" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a> <a id="7348" class="Bound">B₂</a>

  <a id="7354" href="Protocol.Streamlet.Consistency.html#7354" class="Function">vsᴮ′</a> <a id="7359" href="Protocol.Streamlet.Consistency.html#7359" class="Function">vsᴮ⁰′</a> <a id="7365" href="Protocol.Streamlet.Consistency.html#7365" class="Function">vsᴮ²′</a> <a id="7371" class="Symbol">:</a> <a id="7373" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7378" href="Protocol.Streamlet.Assumptions.html#512" class="Function">Pid</a>
  <a id="7384" href="Protocol.Streamlet.Consistency.html#7354" class="Function">vsᴮ′</a>  <a id="7390" class="Symbol">=</a> <a id="7392" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7400" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="7404" class="Bound">B</a>
  <a id="7408" href="Protocol.Streamlet.Consistency.html#7359" class="Function">vsᴮ⁰′</a> <a id="7414" class="Symbol">=</a> <a id="7416" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7424" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="7428" class="Bound">B₀</a>
  <a id="7433" href="Protocol.Streamlet.Consistency.html#7365" class="Function">vsᴮ²′</a> <a id="7439" class="Symbol">=</a> <a id="7441" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7449" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="7453" class="Bound">B₂</a>

  <a id="7459" href="Protocol.Streamlet.Consistency.html#7459" class="Function">uvs</a> <a id="7463" class="Symbol">:</a> <a id="7465" class="Symbol">∀</a> <a id="7467" class="Symbol">{</a><a id="7468" href="Protocol.Streamlet.Consistency.html#7468" class="Bound">b</a><a id="7469" class="Symbol">}</a> <a id="7471" class="Symbol">→</a> <a id="7473" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="7480" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7482" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7490" href="Protocol.Streamlet.Consistency.html#6219" class="Function">ms</a> <a id="7493" href="Protocol.Streamlet.Consistency.html#7468" class="Bound">b</a>
  <a id="7497" href="Protocol.Streamlet.Consistency.html#7459" class="Function">uvs</a> <a id="7501" class="Symbol">{</a><a id="7502" href="Protocol.Streamlet.Consistency.html#7502" class="Bound">b</a><a id="7503" class="Symbol">}</a> <a id="7505" class="Symbol">=</a> <a id="7507" href="Protocol.Streamlet.Invariants.Uniqueness.html#2887" class="Function">uniqueVoteIds</a> <a id="7521" class="Bound">Rs</a>

  <a id="7527" href="Protocol.Streamlet.Consistency.html#7527" class="Function">uvs′</a> <a id="7532" class="Symbol">:</a> <a id="7534" class="Symbol">∀</a> <a id="7536" class="Symbol">{</a><a id="7537" href="Protocol.Streamlet.Consistency.html#7537" class="Bound">b</a><a id="7538" class="Symbol">}</a> <a id="7540" class="Symbol">→</a> <a id="7542" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="7549" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7551" href="Protocol.Streamlet.Local.State.html#2919" class="Function">voteIds</a> <a id="7559" href="Protocol.Streamlet.Consistency.html#6239" class="Function">ms′</a> <a id="7563" href="Protocol.Streamlet.Consistency.html#7537" class="Bound">b</a>
  <a id="7567" href="Protocol.Streamlet.Consistency.html#7527" class="Function">uvs′</a> <a id="7572" class="Symbol">{</a><a id="7573" href="Protocol.Streamlet.Consistency.html#7573" class="Bound">b</a><a id="7574" class="Symbol">}</a> <a id="7576" class="Symbol">=</a> <a id="7578" href="Protocol.Streamlet.Invariants.Uniqueness.html#2887" class="Function">uniqueVoteIds</a> <a id="7592" class="Bound">Rs</a>

  <a id="7598" href="Protocol.Streamlet.Consistency.html#7598" class="Function">mvsᴮ</a>  <a id="7604" class="Symbol">:</a> <a id="7606" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="7617" href="Protocol.Streamlet.Consistency.html#7354" class="Function">vsᴮ′</a>
  <a id="7624" href="Protocol.Streamlet.Consistency.html#7598" class="Function">mvsᴮ</a>  <a id="7630" class="Symbol">=</a> <a id="7632" href="Protocol.Streamlet.Local.State.html#3254" class="Function">enoughVoteIds</a> <a id="7646" class="Bound">nB</a>
  <a id="7651" href="Protocol.Streamlet.Consistency.html#7651" class="Function">mvsᴮ⁰</a> <a id="7657" class="Symbol">:</a> <a id="7659" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="7670" href="Protocol.Streamlet.Consistency.html#7261" class="Function">vsᴮ⁰</a>
  <a id="7677" href="Protocol.Streamlet.Consistency.html#7651" class="Function">mvsᴮ⁰</a> <a id="7683" class="Symbol">=</a> <a id="7685" href="Protocol.Streamlet.Local.State.html#3254" class="Function">enoughVoteIds</a> <a id="7699" class="Bound">nB₀</a>
  <a id="7705" href="Protocol.Streamlet.Consistency.html#7705" class="Function">mvsᴮ²</a> <a id="7711" class="Symbol">:</a> <a id="7713" href="Protocol.Streamlet.Assumptions.html#880" class="Function">IsMajority</a> <a id="7724" href="Protocol.Streamlet.Consistency.html#7266" class="Function">vsᴮ²</a>
  <a id="7731" href="Protocol.Streamlet.Consistency.html#7705" class="Function">mvsᴮ²</a> <a id="7737" class="Symbol">=</a> <a id="7739" href="Protocol.Streamlet.Local.State.html#3254" class="Function">enoughVoteIds</a> <a id="7753" class="Bound">nB₂</a>

  <a id="7760" href="Protocol.Streamlet.Consistency.html#7760" class="Function">B∩B₀</a> <a id="7765" class="Symbol">:</a> <a id="7767" href="Data.Product.Base.html#852" class="Function">∃</a> <a id="7769" class="Symbol">λ</a> <a id="7771" href="Protocol.Streamlet.Consistency.html#7771" class="Bound">p′</a> <a id="7774" class="Symbol">→</a> <a id="7776" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="7783" href="Protocol.Streamlet.Consistency.html#7771" class="Bound">p′</a> <a id="7786" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7788" href="Protocol.Streamlet.Consistency.html#7771" class="Bound">p′</a> <a id="7791" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="7793" href="Protocol.Streamlet.Consistency.html#7257" class="Function">vsᴮ</a> <a id="7797" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7799" href="Protocol.Streamlet.Consistency.html#7771" class="Bound">p′</a> <a id="7802" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="7804" href="Protocol.Streamlet.Consistency.html#7261" class="Function">vsᴮ⁰</a>
  <a id="7811" href="Protocol.Streamlet.Consistency.html#7760" class="Function">B∩B₀</a> <a id="7816" class="Symbol">=</a> <a id="7818" href="Protocol.Streamlet.Consistency.html#1092" class="Function">honest-intersection</a> <a id="7838" href="Protocol.Streamlet.Consistency.html#7527" class="Function">uvs′</a> <a id="7843" href="Protocol.Streamlet.Consistency.html#7459" class="Function">uvs</a> <a id="7847" href="Protocol.Streamlet.Consistency.html#7598" class="Function">mvsᴮ</a> <a id="7852" href="Protocol.Streamlet.Consistency.html#7651" class="Function">mvsᴮ⁰</a>

  <a id="7861" href="Protocol.Streamlet.Consistency.html#7861" class="Function">B∩B₂</a> <a id="7866" class="Symbol">:</a> <a id="7868" href="Data.Product.Base.html#852" class="Function">∃</a> <a id="7870" class="Symbol">λ</a> <a id="7872" href="Protocol.Streamlet.Consistency.html#7872" class="Bound">p′</a> <a id="7875" class="Symbol">→</a> <a id="7877" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="7884" href="Protocol.Streamlet.Consistency.html#7872" class="Bound">p′</a> <a id="7887" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7889" href="Protocol.Streamlet.Consistency.html#7872" class="Bound">p′</a> <a id="7892" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="7894" href="Protocol.Streamlet.Consistency.html#7257" class="Function">vsᴮ</a> <a id="7898" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7900" href="Protocol.Streamlet.Consistency.html#7872" class="Bound">p′</a> <a id="7903" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="7905" href="Protocol.Streamlet.Consistency.html#7266" class="Function">vsᴮ²</a>
  <a id="7912" href="Protocol.Streamlet.Consistency.html#7861" class="Function">B∩B₂</a> <a id="7917" class="Symbol">=</a> <a id="7919" href="Protocol.Streamlet.Consistency.html#1092" class="Function">honest-intersection</a> <a id="7939" href="Protocol.Streamlet.Consistency.html#7527" class="Function">uvs′</a> <a id="7944" href="Protocol.Streamlet.Consistency.html#7459" class="Function">uvs</a> <a id="7948" href="Protocol.Streamlet.Consistency.html#7598" class="Function">mvsᴮ</a> <a id="7953" href="Protocol.Streamlet.Consistency.html#7705" class="Function">mvsᴮ²</a>

  <a id="7962" href="Protocol.Streamlet.Consistency.html#7962" class="Function">QED</a> <a id="7966" class="Symbol">:</a> <a id="7968" href="Data.Empty.html#895" class="Function">⊥</a>
  <a id="7972" href="Protocol.Streamlet.Consistency.html#7962" class="Function">QED</a>
    <a id="7980" class="Keyword">with</a> <a id="7985" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a> <a id="7988" href="Data.Nat.Properties.html#6146" class="Function Operator">≤?</a> <a id="7991" href="Protocol.Streamlet.Consistency.html#6326" class="Function">e₂</a> <a id="7994" class="Symbol">|</a> <a id="7996" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="7998" class="Bound">e₂≡</a> <a id="8002" class="Symbol">|</a> <a id="8004" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="8006" class="Bound">e₁≡</a>
  <a id="8012" href="Protocol.Streamlet.Consistency.html#7962" class="Function">...</a> <a id="8016" class="Symbol">|</a> <a id="8018" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="8021" href="Protocol.Streamlet.Consistency.html#8021" class="Bound">eᴮ≰e₂</a> <a id="8027" class="Symbol">|</a> <a id="8029" class="Symbol">_</a> <a id="8031" class="Symbol">|</a> <a id="8033" class="Symbol">_</a>
    <a id="8039" class="Comment">-- Case (2): eᴮ &gt; e + 2</a>
    <a id="8067" class="Symbol">=</a> <a id="8069" href="Data.Nat.Properties.html#8576" class="Function">≤⇒≯</a> <a id="8073" href="Protocol.Streamlet.Consistency.html#8099" class="Function">e₂≤eᴮ</a> <a id="8079" href="Protocol.Streamlet.Consistency.html#8148" class="Function">e₂&gt;eᴮ</a>
    <a id="8089" class="Keyword">where</a>
    <a id="8099" href="Protocol.Streamlet.Consistency.html#8099" class="Function">e₂≤eᴮ</a> <a id="8105" class="Symbol">:</a> <a id="8107" href="Protocol.Streamlet.Consistency.html#6326" class="Function">e₂</a> <a id="8110" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤</a> <a id="8112" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a>
    <a id="8119" href="Protocol.Streamlet.Consistency.html#8099" class="Function">e₂≤eᴮ</a> <a id="8125" class="Symbol">=</a> <a id="8127" href="Data.Nat.Properties.html#8970" class="Function">≮⇒≥</a> <a id="8131" class="Symbol">(</a><a id="8132" href="Data.Nat.Properties.html#8745" class="Function">≰⇒≮</a> <a id="8136" href="Protocol.Streamlet.Consistency.html#8021" class="Bound">eᴮ≰e₂</a><a id="8141" class="Symbol">)</a>

    <a id="8148" href="Protocol.Streamlet.Consistency.html#8148" class="Function">e₂&gt;eᴮ</a> <a id="8154" class="Symbol">:</a> <a id="8156" href="Protocol.Streamlet.Consistency.html#6326" class="Function">e₂</a> <a id="8159" href="Data.Nat.Base.html#2289" class="Function Operator">&gt;</a> <a id="8161" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a>
    <a id="8168" href="Protocol.Streamlet.Consistency.html#8148" class="Function">e₂&gt;eᴮ</a> <a id="8174" class="Symbol">=</a>
      <a id="8182" class="Keyword">let</a>
        <a id="8194" href="Protocol.Streamlet.Consistency.html#8194" class="Bound">p″</a> <a id="8197" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8199" href="Protocol.Streamlet.Consistency.html#8199" class="Bound">hp″</a> <a id="8203" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8205" href="Protocol.Streamlet.Consistency.html#8205" class="Bound">p∈′</a> <a id="8209" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8211" href="Protocol.Streamlet.Consistency.html#8211" class="Bound">p∈</a> <a id="8214" class="Symbol">=</a> <a id="8216" href="Protocol.Streamlet.Consistency.html#7861" class="Function">B∩B₂</a>
        <a id="8229" class="Keyword">instance</a> <a id="8238" href="Protocol.Streamlet.Consistency.html#8238" class="Bound">_</a> <a id="8240" class="Symbol">=</a> <a id="8242" href="Protocol.Streamlet.Consistency.html#8199" class="Bound">hp″</a>

        <a id="8255" href="Protocol.Streamlet.Consistency.html#8255" class="Bound">len&lt;</a> <a id="8260" class="Symbol">:</a> <a id="8262" href="Data.List.Base.html#5083" class="Function">length</a> <a id="8269" class="Bound">ch′</a> <a id="8273" href="Data.Nat.Base.html#1801" class="Function Operator">&lt;</a> <a id="8275" href="Data.List.Base.html#5083" class="Function">length</a> <a id="8282" href="Protocol.Streamlet.Consistency.html#6359" class="Function">ch₁</a>
        <a id="8294" href="Protocol.Streamlet.Consistency.html#8255" class="Bound">len&lt;</a> <a id="8299" class="Symbol">=</a> <a id="8301" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="8307" class="Symbol">(</a><a id="8308" href="Data.Nat.Base.html#1801" class="Function Operator">_&lt;</a> <a id="8311" class="Symbol">_)</a> <a id="8314" class="Symbol">(</a><a id="8315" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="8319" class="Bound">len≡</a><a id="8323" class="Symbol">)</a>  <a id="8326" class="Symbol">(</a><a id="8327" href="Data.Nat.Properties.html#12280" class="Function">n&lt;1+n</a> <a id="8333" href="Protocol.Streamlet.Consistency.html#6412" class="Function">ℓ</a><a id="8334" class="Symbol">)</a>
      <a id="8342" class="Keyword">in</a>
        <a id="8353" href="Protocol.Streamlet.Invariants.IncreasingEpochs.html#10690" class="Function">increasingEpochs</a> <a id="8370" class="Bound">Rs</a> <a id="8373" href="Protocol.Streamlet.Consistency.html#8205" class="Bound">p∈′</a> <a id="8377" class="Bound">Bconnects</a> <a id="8387" href="Protocol.Streamlet.Consistency.html#8211" class="Bound">p∈</a> <a id="8390" class="Bound">B₂connects</a> <a id="8401" href="Protocol.Streamlet.Consistency.html#8255" class="Bound">len&lt;</a>
  <a id="8408" href="Protocol.Streamlet.Consistency.html#7962" class="Function">...</a> <a id="8412" class="Symbol">|</a> <a id="8414" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="8418" href="Protocol.Streamlet.Consistency.html#8418" class="Bound">e&gt;</a> <a id="8421" class="Symbol">|</a> <a id="8423" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="8425" href="Protocol.Streamlet.Consistency.html#8425" class="Bound">e₂≡</a> <a id="8429" class="Symbol">|</a> <a id="8431" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="8433" href="Protocol.Streamlet.Consistency.html#8433" class="Bound">e₁≡</a>
    <a id="8441" class="Keyword">with</a> <a id="8446" href="Data.Nat.Properties.html#62392" class="Function">≤⇒≤′</a> <a id="8451" href="Protocol.Streamlet.Consistency.html#8418" class="Bound">e&gt;</a>
  <a id="8456" class="Symbol">...</a> <a id="8460" class="Symbol">|</a> <a id="8462" href="Data.Nat.Base.html#7736" class="InductiveConstructor">≤′-refl</a>
    <a id="8474" class="Symbol">=</a> <a id="8476" href="Protocol.Streamlet.Consistency.html#7133" class="Function">B₂≢B</a> <a id="8481" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8483" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="8502" class="Bound">Rs</a> <a id="8505" class="Bound">nB₂</a> <a id="8509" class="Bound">nB</a> <a id="8512" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="8519" class="Symbol">...</a> <a id="8523" class="Symbol">|</a> <a id="8525" href="Data.Nat.Base.html#7779" class="InductiveConstructor">≤′-step</a> <a id="8533" href="Data.Nat.Base.html#7736" class="InductiveConstructor">≤′-refl</a>
    <a id="8545" class="Keyword">with</a> <a id="8550" href="Protocol.Streamlet.Consistency.html#8550" class="Bound">e≡</a> ← <a id="8555" href="Data.Nat.Properties.html#2703" class="Function">suc-injective</a> <a id="8569" class="Bound">e₂≡</a>
    <a id="8577" class="Symbol">=</a> <a id="8579" href="Protocol.Streamlet.Consistency.html#6164" class="Bound">B₁≢B</a> <a id="8584" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8586" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="8605" class="Bound">Rs</a> <a id="8608" class="Bound">nB₁</a> <a id="8612" class="Bound">nB</a> <a id="8615" class="Symbol">(</a><a id="8616" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="8620" href="Protocol.Streamlet.Consistency.html#8550" class="Bound">e≡</a><a id="8622" class="Symbol">)</a>
  <a id="8626" class="Symbol">...</a> <a id="8630" class="Symbol">|</a> <a id="8632" href="Data.Nat.Base.html#7779" class="InductiveConstructor">≤′-step</a> <a id="8640" class="Symbol">(</a><a id="8641" href="Data.Nat.Base.html#7779" class="InductiveConstructor">≤′-step</a> <a id="8649" href="Data.Nat.Base.html#7736" class="InductiveConstructor">≤′-refl</a><a id="8656" class="Symbol">)</a>
    <a id="8662" class="Keyword">with</a> <a id="8667" href="Protocol.Streamlet.Consistency.html#8667" class="Bound">e≡</a> ← <a id="8672" href="Data.Nat.Properties.html#2703" class="Function">suc-injective</a> <a id="8686" class="Bound">e₂≡</a>
    <a id="8694" class="Symbol">=</a> <a id="8696" href="Protocol.Streamlet.Consistency.html#7045" class="Function">B₀≢B</a> <a id="8701" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8703" href="Protocol.Streamlet.Consistency.html#3585" class="Function">uniqueNotarization</a> <a id="8722" class="Bound">Rs</a> <a id="8725" class="Bound">nB₀</a> <a id="8729" class="Bound">nB</a> <a id="8732" href="Protocol.Streamlet.Consistency.html#8746" class="Function">e≡′</a>
    <a id="8740" class="Keyword">where</a> <a id="8746" href="Protocol.Streamlet.Consistency.html#8746" class="Function">e≡′</a> <a id="8750" class="Symbol">:</a> <a id="8752" href="Protocol.Streamlet.Consistency.html#6292" class="Function">e₀</a> <a id="8755" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8757" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a>
          <a id="8770" href="Protocol.Streamlet.Consistency.html#8746" class="Function">e≡′</a> <a id="8774" class="Symbol">=</a> <a id="8776" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="8780" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8782" href="Data.Nat.Properties.html#2703" class="Function">suc-injective</a> <a id="8796" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8798" href="Relation.Binary.PropositionalEquality.Core.html#1757" class="Function">trans</a> <a id="8804" href="Protocol.Streamlet.Consistency.html#8667" class="Bound">e≡</a> <a id="8807" class="Bound">e₁≡</a>
  <a id="8813" class="CatchallClause Symbol">...</a><a id="8816" class="CatchallClause"> </a><a id="8817" class="CatchallClause Symbol">|</a><a id="8818" class="CatchallClause"> </a><a id="8819" href="Data.Nat.Base.html#7779" class="CatchallClause InductiveConstructor">≤′-step</a><a id="8826" class="CatchallClause"> </a><a id="8827" class="CatchallClause Symbol">(</a><a id="8828" href="Data.Nat.Base.html#7779" class="CatchallClause InductiveConstructor">≤′-step</a><a id="8835" class="CatchallClause"> </a><a id="8836" href="Protocol.Streamlet.Consistency.html#8836" class="CatchallClause Bound">eᴮ≤′</a><a id="8840" class="CatchallClause Symbol">)</a>
    <a id="8846" class="Comment">-- Case (1): eᴮ &lt; e</a>
    <a id="8870" class="Symbol">=</a> <a id="8872" href="Data.Nat.Properties.html#8576" class="Function">≤⇒≯</a> <a id="8876" href="Protocol.Streamlet.Consistency.html#8902" class="Function">eᴮ≤e₀</a> <a id="8882" href="Protocol.Streamlet.Consistency.html#9051" class="Function">eᴮ&gt;e₀</a>
    <a id="8892" class="Keyword">where</a>
    <a id="8902" href="Protocol.Streamlet.Consistency.html#8902" class="Function">eᴮ≤e₀</a> <a id="8908" class="Symbol">:</a> <a id="8910" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a> <a id="8913" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤</a> <a id="8915" href="Protocol.Streamlet.Consistency.html#6292" class="Function">e₀</a>
    <a id="8922" href="Protocol.Streamlet.Consistency.html#8902" class="Function">eᴮ≤e₀</a> <a id="8928" class="Symbol">=</a> <a id="8930" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="8936" class="Symbol">(_</a> <a id="8939" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤_</a><a id="8941" class="Symbol">)</a>
                  <a id="8961" class="Symbol">(</a><a id="8962" href="Data.Nat.Properties.html#2703" class="Function">suc-injective</a> <a id="8976" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8978" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="8984" class="Symbol">(_</a> <a id="8987" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="8989" class="Symbol">)</a> <a id="8991" class="Bound">e₁≡</a> <a id="8995" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8997" href="Data.Nat.Properties.html#2703" class="Function">suc-injective</a> <a id="9011" class="Bound">e₂≡</a><a id="9014" class="Symbol">)</a>
                  <a id="9034" class="Symbol">(</a><a id="9035" href="Data.Nat.Properties.html#62300" class="Function">≤′⇒≤</a> <a id="9040" href="Protocol.Streamlet.Consistency.html#8836" class="Bound">eᴮ≤′</a><a id="9044" class="Symbol">)</a>

    <a id="9051" href="Protocol.Streamlet.Consistency.html#9051" class="Function">eᴮ&gt;e₀</a> <a id="9057" class="Symbol">:</a> <a id="9059" href="Protocol.Streamlet.Consistency.html#6275" class="Function">eᴮ</a> <a id="9062" href="Data.Nat.Base.html#2289" class="Function Operator">&gt;</a> <a id="9064" href="Protocol.Streamlet.Consistency.html#6292" class="Function">e₀</a>
    <a id="9071" href="Protocol.Streamlet.Consistency.html#9051" class="Function">eᴮ&gt;e₀</a> <a id="9077" class="Symbol">=</a>
      <a id="9085" class="Keyword">let</a>
        <a id="9097" href="Protocol.Streamlet.Consistency.html#9097" class="Bound">p″</a> <a id="9100" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9102" href="Protocol.Streamlet.Consistency.html#9102" class="Bound">hp″</a> <a id="9106" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9108" href="Protocol.Streamlet.Consistency.html#9108" class="Bound">p∈′</a> <a id="9112" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9114" href="Protocol.Streamlet.Consistency.html#9114" class="Bound">p∈</a> <a id="9117" class="Symbol">=</a> <a id="9119" href="Protocol.Streamlet.Consistency.html#7760" class="Function">B∩B₀</a>
        <a id="9132" class="Keyword">instance</a> <a id="9141" href="Protocol.Streamlet.Consistency.html#9141" class="Bound">_</a> <a id="9143" class="Symbol">=</a> <a id="9145" href="Protocol.Streamlet.Consistency.html#9102" class="Bound">hp″</a>

        <a id="9158" href="Protocol.Streamlet.Consistency.html#9158" class="Bound">len&lt;</a> <a id="9163" class="Symbol">:</a> <a id="9165" href="Data.List.Base.html#5083" class="Function">length</a> <a id="9172" class="Bound">ch₀</a> <a id="9176" href="Data.Nat.Base.html#1801" class="Function Operator">&lt;</a> <a id="9178" href="Data.List.Base.html#5083" class="Function">length</a> <a id="9185" class="Bound">ch′</a>
        <a id="9197" href="Protocol.Streamlet.Consistency.html#9158" class="Bound">len&lt;</a> <a id="9202" class="Symbol">=</a> <a id="9204" href="Relation.Binary.PropositionalEquality.Core.html#1808" class="Function">subst</a> <a id="9210" class="Symbol">(_</a> <a id="9213" href="Data.Nat.Base.html#1801" class="Function Operator">&lt;_</a><a id="9215" class="Symbol">)</a> <a id="9217" class="Symbol">(</a><a id="9218" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="9222" class="Bound">len≡</a><a id="9226" class="Symbol">)</a> <a id="9228" class="Symbol">(</a><a id="9229" href="Data.Nat.Properties.html#12280" class="Function">n&lt;1+n</a> <a id="9235" href="Protocol.Streamlet.Consistency.html#6393" class="Function">ℓ-1</a><a id="9238" class="Symbol">)</a>
      <a id="9246" class="Keyword">in</a>
        <a id="9257" href="Protocol.Streamlet.Invariants.IncreasingEpochs.html#10690" class="Function">increasingEpochs</a> <a id="9274" class="Bound">Rs</a> <a id="9277" href="Protocol.Streamlet.Consistency.html#9114" class="Bound">p∈</a> <a id="9280" class="Bound">B₀connects</a> <a id="9291" href="Protocol.Streamlet.Consistency.html#9108" class="Bound">p∈′</a> <a id="9295" class="Bound">Bconnects</a> <a id="9305" href="Protocol.Streamlet.Consistency.html#9158" class="Bound">len&lt;</a>
</pre>
### Consistency (a.k.a. safety)

** Paper statement **
Suppose that chain and chain' are two notarized chains in honest view
/both/ ending at three blocks with consecutive epoch numbers.
Denote the length of chain as ℓ, and the length of chain' as ℓ'.
Moreover, suppose that ℓ ≤ ℓ'. It must be that chain[: ℓ - 1] ≼ chain'[: ℓ' - 1].

** Strengthened version **
Suppose that chain and chain' are two notarized chains in honest view
/and the former/ ending at three blocks with consecutive epoch numbers.
Denote the length of chain as ℓ, and the length of chain' as ℓ'.
Moreover, suppose that ℓ ≤ ℓ'. It must be that chain[: ℓ - 1] ≼ chain'[: ℓ' - 1].

<pre class="Agda"><a id="9975" class="Comment">-- Theorem 3&#39; (restricted version only for ≡)</a>
<a id="ConsistencyEqualLen"></a><a id="10021" href="Protocol.Streamlet.Consistency.html#10021" class="Function">ConsistencyEqualLen</a> <a id="10041" class="Symbol">:</a> <a id="10043" href="Protocol.Streamlet.Global.Traces.html#966" class="Function">StateProperty</a>
<a id="10057" href="Protocol.Streamlet.Consistency.html#10021" class="Function">ConsistencyEqualLen</a> <a id="10077" href="Protocol.Streamlet.Consistency.html#10077" class="Bound">s</a> <a id="10079" class="Symbol">=</a> <a id="10081" class="Symbol">∀</a> <a id="10083" class="Symbol">{</a><a id="10084" href="Protocol.Streamlet.Consistency.html#10084" class="Bound">p</a> <a id="10086" href="Protocol.Streamlet.Consistency.html#10086" class="Bound">p′</a> <a id="10089" href="Protocol.Streamlet.Consistency.html#10089" class="Bound">b</a> <a id="10091" href="Protocol.Streamlet.Consistency.html#10091" class="Bound">ch</a> <a id="10094" href="Protocol.Streamlet.Consistency.html#10094" class="Bound">ch′</a><a id="10097" class="Symbol">}</a> <a id="10099" class="Symbol">⦃</a> <a id="10101" href="Protocol.Streamlet.Consistency.html#10101" class="Bound">_</a> <a id="10103" class="Symbol">:</a> <a id="10105" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="10112" href="Protocol.Streamlet.Consistency.html#10084" class="Bound">p</a> <a id="10114" class="Symbol">⦄</a> <a id="10116" class="Symbol">⦃</a> <a id="10118" href="Protocol.Streamlet.Consistency.html#10118" class="Bound">_</a> <a id="10120" class="Symbol">:</a> <a id="10122" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="10129" href="Protocol.Streamlet.Consistency.html#10086" class="Bound">p′</a> <a id="10132" class="Symbol">⦄</a> <a id="10134" class="Symbol">→</a>
  <a id="10138" class="Keyword">let</a>
    <a id="10146" href="Protocol.Streamlet.Consistency.html#10146" class="Bound">ms</a>  <a id="10150" class="Symbol">=</a> <a id="10152" class="Symbol">(</a><a id="10153" href="Protocol.Streamlet.Consistency.html#10077" class="Bound">s</a> <a id="10155" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="10157" href="Protocol.Streamlet.Consistency.html#10084" class="Bound">p</a><a id="10158" class="Symbol">)</a>  <a id="10161" class="Symbol">.</a><a id="10162" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
    <a id="10169" href="Protocol.Streamlet.Consistency.html#10169" class="Bound">ms′</a> <a id="10173" class="Symbol">=</a> <a id="10175" class="Symbol">(</a><a id="10176" href="Protocol.Streamlet.Consistency.html#10077" class="Bound">s</a> <a id="10178" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="10180" href="Protocol.Streamlet.Consistency.html#10086" class="Bound">p′</a><a id="10182" class="Symbol">)</a> <a id="10184" class="Symbol">.</a><a id="10185" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
  <a id="10190" class="Keyword">in</a>
  <a id="10195" href="Prelude.InferenceRules.html#56097" class="Function Operator">∙</a> <a id="10197" class="Symbol">(</a><a id="10198" href="Protocol.Streamlet.Consistency.html#10089" class="Bound">b</a> <a id="10200" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10202" href="Protocol.Streamlet.Consistency.html#10091" class="Bound">ch</a><a id="10204" class="Symbol">)</a> <a id="10206" href="Protocol.Streamlet.Local.State.html#1652" class="Datatype Operator">chain-∈</a> <a id="10214" href="Protocol.Streamlet.Consistency.html#10146" class="Bound">ms</a>
  <a id="10219" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="10221" href="Protocol.Streamlet.Consistency.html#10094" class="Bound">ch′</a> <a id="10225" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="10243" href="Protocol.Streamlet.Consistency.html#10169" class="Bound">ms′</a>
  <a id="10249" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="10251" href="Protocol.Streamlet.Local.State.html#3689" class="Datatype">FinalizedChain</a> <a id="10266" href="Protocol.Streamlet.Consistency.html#10146" class="Bound">ms</a> <a id="10269" href="Protocol.Streamlet.Consistency.html#10091" class="Bound">ch</a> <a id="10272" href="Protocol.Streamlet.Consistency.html#10089" class="Bound">b</a>
  <a id="10276" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="10278" href="Data.List.Base.html#5083" class="Function">length</a> <a id="10285" href="Protocol.Streamlet.Consistency.html#10091" class="Bound">ch</a> <a id="10288" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10290" href="Data.List.Base.html#5083" class="Function">length</a> <a id="10297" href="Protocol.Streamlet.Consistency.html#10094" class="Bound">ch′</a>
    <a id="10305" href="Prelude.InferenceRules.html#13789" class="Function Operator">──────────────────────────────</a>
    <a id="10340" href="Protocol.Streamlet.Consistency.html#10091" class="Bound">ch</a> <a id="10343" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10345" href="Protocol.Streamlet.Consistency.html#10094" class="Bound">ch′</a>
</pre>
** Proof **
Suppose that chain and chain' are two finalized chains in honest view.
Denote the length of chain as ℓ, and the length of chain' as ℓ', and ℓ ≤ ℓ'.
It must be that chain[: ℓ - 1] ≼ chain'[: ℓ' - 1]. ∎

<pre class="Agda"><a id="consistencyEqualLen"></a><a id="10576" href="Protocol.Streamlet.Consistency.html#10576" class="Function">consistencyEqualLen</a> <a id="10596" class="Symbol">:</a> <a id="10598" href="Prelude.Closures.html#3717" class="Function">Invariant</a> <a id="10608" href="Protocol.Streamlet.Consistency.html#10021" class="Function">ConsistencyEqualLen</a>
<a id="10628" href="Protocol.Streamlet.Consistency.html#10576" class="Function">consistencyEqualLen</a> <a id="10648" class="Symbol">(_</a> <a id="10651" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10653" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="10658" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10660" class="Symbol">(_</a> <a id="10663" href="Prelude.Closures.html#689" class="InductiveConstructor Operator">∎</a><a id="10664" class="Symbol">))</a> <a id="10667" class="Symbol">{</a><a id="10668" href="Protocol.Streamlet.Consistency.html#10668" class="Bound">p</a><a id="10669" class="Symbol">}</a> <a id="10671" class="Symbol">(</a><a id="10672" href="Protocol.Streamlet.Consistency.html#10672" class="Bound">b∈</a> <a id="10675" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="10677" class="Symbol">_</a> <a id="10679" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="10681" class="Symbol">_)</a> <a id="10684" class="Symbol">_</a> <a id="10686" class="Symbol">_</a> <a id="10688" class="Symbol">_</a>
  <a id="10692" class="Keyword">rewrite</a> <a id="10700" class="Keyword">let</a> <a id="10704" class="Keyword">open</a> <a id="10709" href="Protocol.Streamlet.Global.Step.html#3796" class="Module">∣Base∣</a> <a id="10716" href="Protocol.Streamlet.Consistency.html#10668" class="Bound">p</a> <a id="10718" class="Keyword">in</a> <a id="10721" href="Protocol.Streamlet.Global.Step.html#3830" class="Function">lookup✓</a>
  <a id="10731" class="Symbol">=</a> <a id="10733" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="10738" href="Protocol.Streamlet.Consistency.html#10672" class="Bound">b∈</a> <a id="10741" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="10744" class="Symbol">λ</a> <a id="10746" class="Symbol">()</a>
<a id="10749" href="Protocol.Streamlet.Consistency.html#10576" class="Function">consistencyEqualLen</a>
  <a id="10771" href="Protocol.Streamlet.Consistency.html#10771" class="Bound">Rs</a><a id="10773" class="Symbol">@(_</a> <a id="10777" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10779" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="10784" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10786" class="Symbol">(_</a> <a id="10789" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟨</a> <a id="10791" href="Protocol.Streamlet.Consistency.html#10791" class="Bound">x</a> <a id="10793" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟩←—</a> <a id="10797" href="Protocol.Streamlet.Consistency.html#10797" class="Bound">tr</a><a id="10799" class="Symbol">))</a> <a id="10802" class="Symbol">{</a><a id="10803" href="Protocol.Streamlet.Consistency.html#10803" class="Bound">p</a><a id="10804" class="Symbol">}{</a><a id="10806" class="Argument">ch</a> <a id="10809" class="Symbol">=</a> <a id="10811" href="Protocol.Streamlet.Consistency.html#10811" class="Bound">ch</a><a id="10813" class="Symbol">}</a> <a id="10815" class="Symbol">{</a><a id="10816" href="Protocol.Streamlet.Consistency.html#10816" class="Bound">ch′</a><a id="10819" class="Symbol">}</a>
  <a id="10823" href="Protocol.Streamlet.Consistency.html#10823" class="Bound">b∷ch∈</a><a id="10828" class="Symbol">@(_</a> <a id="10832" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="10834" href="Protocol.Streamlet.Consistency.html#10834" class="Bound">ch∈</a> <a id="10838" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="10840" class="Symbol">_)</a> <a id="10843" href="Protocol.Streamlet.Consistency.html#10843" class="Bound">nch∈′</a><a id="10848" class="Symbol">@(</a><a id="10850" href="Protocol.Streamlet.Consistency.html#10850" class="Bound">ch∈′</a> <a id="10855" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10857" href="Protocol.Streamlet.Consistency.html#10857" class="Bound">nch′</a><a id="10861" class="Symbol">)</a> <a id="10863" href="Protocol.Streamlet.Consistency.html#10863" class="Bound">fch</a> <a id="10867" href="Protocol.Streamlet.Consistency.html#10867" class="Bound">len≡</a>
  <a id="10874" class="Symbol">=</a> <a id="10876" href="Protocol.Streamlet.Consistency.html#10890" class="Function">ch≡</a>
  <a id="10882" class="Keyword">where</a>
  <a id="10890" href="Protocol.Streamlet.Consistency.html#10890" class="Function">ch≡</a> <a id="10894" class="Symbol">:</a> <a id="10896" href="Protocol.Streamlet.Consistency.html#10811" class="Bound">ch</a> <a id="10899" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10901" href="Protocol.Streamlet.Consistency.html#10816" class="Bound">ch′</a>
  <a id="10907" href="Protocol.Streamlet.Consistency.html#10890" class="Function">ch≡</a> <a id="10911" class="Keyword">with</a> <a id="10916" href="Protocol.Streamlet.Consistency.html#10811" class="Bound">ch</a> <a id="10919" href="Prelude.DecEq.html#123" class="Field Operator">≟</a> <a id="10921" href="Protocol.Streamlet.Consistency.html#10816" class="Bound">ch′</a>
  <a id="10927" href="Protocol.Streamlet.Consistency.html#10890" class="Function">...</a> <a id="10931" class="Symbol">|</a> <a id="10933" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="10937" href="Protocol.Streamlet.Consistency.html#10937" class="Bound">ch≡</a> <a id="10941" class="Symbol">=</a> <a id="10943" href="Protocol.Streamlet.Consistency.html#10937" class="Bound">ch≡</a>
  <a id="10949" href="Protocol.Streamlet.Consistency.html#10890" class="Function">...</a> <a id="10953" class="Symbol">|</a> <a id="10955" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="10959" href="Protocol.Streamlet.Consistency.html#10959" class="Bound">ch≢</a>
    <a id="10967" class="Keyword">with</a> <a id="10972" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="10974" href="Protocol.Streamlet.Consistency.html#10974" class="Bound">B</a>  <a id="10977" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10979" class="Symbol">_</a> ← <a id="10983" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="10985" href="Protocol.Streamlet.Consistency.html#10811" class="Bound">ch</a>
    <a id="10992" class="Keyword">with</a> <a id="10997" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="10999" href="Protocol.Streamlet.Consistency.html#10816" class="Bound">ch′</a>    <a id="11006" class="Symbol">|</a> <a id="11008" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="11010" href="Protocol.Streamlet.Consistency.html#10857" class="Bound">nch′</a>
  <a id="11017" class="Symbol">...</a> <a id="11021" class="Symbol">|</a> <a id="11023" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="11025" href="Protocol.Streamlet.Consistency.html#11025" class="Bound">B′</a>  <a id="11029" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11031" class="Symbol">_</a> <a id="11033" class="Symbol">|</a> <a id="11035" href="Prelude.Init.html#7442" class="InductiveConstructor Operator">⟫</a> <a id="11037" href="Protocol.Streamlet.Consistency.html#11037" class="Bound">nB′</a> <a id="11041" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="11043" class="Symbol">_</a>
    <a id="11049" class="Symbol">=</a> <a id="11051" href="Protocol.Streamlet.Consistency.html#11345" class="Function">QED</a>
    <a id="11059" class="Keyword">where</a>
    <a id="11069" href="Protocol.Streamlet.Consistency.html#11069" class="Function">vch</a> <a id="11073" class="Symbol">:</a> <a id="11075" href="Protocol.Streamlet.Local.Chain.html#1198" class="Datatype">ValidChain</a> <a id="11086" href="Protocol.Streamlet.Consistency.html#10811" class="Bound">ch</a>
    <a id="11093" href="Protocol.Streamlet.Consistency.html#11069" class="Function">vch</a> <a id="11097" class="Symbol">=</a> <a id="11099" href="Protocol.Streamlet.Local.State.html#1944" class="Function">chain-∈⇒Valid</a> <a id="11113" href="Protocol.Streamlet.Consistency.html#10834" class="Bound">ch∈</a>

    <a id="11122" href="Protocol.Streamlet.Consistency.html#11122" class="Function">vch′</a> <a id="11127" class="Symbol">:</a> <a id="11129" href="Protocol.Streamlet.Local.Chain.html#1198" class="Datatype">ValidChain</a> <a id="11140" href="Protocol.Streamlet.Consistency.html#10816" class="Bound">ch′</a>
    <a id="11148" href="Protocol.Streamlet.Consistency.html#11122" class="Function">vch′</a> <a id="11153" class="Symbol">=</a> <a id="11155" href="Protocol.Streamlet.Local.State.html#1944" class="Function">chain-∈⇒Valid</a> <a id="11169" href="Protocol.Streamlet.Consistency.html#10850" class="Bound">ch∈′</a>

    <a id="11179" href="Protocol.Streamlet.Consistency.html#11179" class="Function">b≢</a> <a id="11182" class="Symbol">:</a> <a id="11184" href="Protocol.Streamlet.Consistency.html#10974" class="Bound">B</a> <a id="11186" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="11188" href="Protocol.Streamlet.Consistency.html#11025" class="Bound">B′</a>
    <a id="11195" href="Protocol.Streamlet.Consistency.html#11179" class="Function">b≢</a> <a id="11198" href="Protocol.Streamlet.Consistency.html#11198" class="Bound">b≡</a><a id="11200" class="Symbol">@</a><a id="11201" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="11206" class="Symbol">=</a> <a id="11208" class="Bound">ch≢</a> <a id="11212" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="11214" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="11219" class="Symbol">(_</a> <a id="11222" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷_</a><a id="11224" class="Symbol">)</a> <a id="11226" class="Symbol">(</a><a id="11227" href="Protocol.Streamlet.Local.Chain.html#1855" class="Function">b≡→ch≡</a> <a id="11234" href="Protocol.Streamlet.Consistency.html#11069" class="Function">vch</a> <a id="11238" href="Protocol.Streamlet.Consistency.html#11122" class="Function">vch′</a> <a id="11243" href="Protocol.Streamlet.Consistency.html#11198" class="Bound">b≡</a><a id="11245" class="Symbol">)</a>

    <a id="11252" href="Protocol.Streamlet.Consistency.html#11252" class="Function">b≡</a> <a id="11255" class="Symbol">:</a> <a id="11257" href="Protocol.Streamlet.Consistency.html#10974" class="Bound">B</a> <a id="11259" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11261" href="Protocol.Streamlet.Consistency.html#11025" class="Bound">B′</a>
    <a id="11268" href="Protocol.Streamlet.Consistency.html#11252" class="Function">b≡</a> <a id="11271" class="Symbol">=</a> <a id="11273" href="Protocol.Streamlet.Consistency.html#5694" class="Function">consistencyLemma</a> <a id="11290" href="Protocol.Streamlet.Consistency.html#10771" class="Bound">Rs</a> <a id="11293" href="Protocol.Streamlet.Consistency.html#10823" class="Bound">b∷ch∈</a> <a id="11299" href="Protocol.Streamlet.Consistency.html#10863" class="Bound">fch</a> <a id="11303" href="Protocol.Streamlet.Consistency.html#10843" class="Bound">nch∈′</a> <a id="11309" class="Symbol">(</a><a id="11310" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="11314" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="11316" href="Data.Nat.Properties.html#2703" class="Function">Nat.suc-injective</a> <a id="11334" href="Protocol.Streamlet.Consistency.html#10867" class="Bound">len≡</a><a id="11338" class="Symbol">)</a>

    <a id="11345" href="Protocol.Streamlet.Consistency.html#11345" class="Function">QED</a> <a id="11349" class="Symbol">:</a> <a id="11351" class="Symbol">_</a>
    <a id="11357" href="Protocol.Streamlet.Consistency.html#11345" class="Function">QED</a> <a id="11361" class="Symbol">=</a> <a id="11363" href="Data.Empty.html#1050" class="Function">⊥-elim</a> <a id="11370" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="11372" href="Protocol.Streamlet.Consistency.html#11179" class="Function">b≢</a> <a id="11375" href="Protocol.Streamlet.Consistency.html#11252" class="Function">b≡</a>
</pre>
<pre class="Agda"><a id="11391" class="Comment">-- Theorem 3</a>
<a id="Consistency"></a><a id="11404" href="Protocol.Streamlet.Consistency.html#11404" class="Function">Consistency</a> <a id="11416" class="Symbol">:</a> <a id="11418" href="Protocol.Streamlet.Global.Traces.html#966" class="Function">StateProperty</a>
<a id="11432" href="Protocol.Streamlet.Consistency.html#11404" class="Function">Consistency</a> <a id="11444" href="Protocol.Streamlet.Consistency.html#11444" class="Bound">s</a> <a id="11446" class="Symbol">=</a> <a id="11448" class="Symbol">∀</a> <a id="11450" class="Symbol">{</a><a id="11451" href="Protocol.Streamlet.Consistency.html#11451" class="Bound">p</a> <a id="11453" href="Protocol.Streamlet.Consistency.html#11453" class="Bound">p′</a> <a id="11456" href="Protocol.Streamlet.Consistency.html#11456" class="Bound">b</a> <a id="11458" href="Protocol.Streamlet.Consistency.html#11458" class="Bound">ch</a> <a id="11461" href="Protocol.Streamlet.Consistency.html#11461" class="Bound">ch′</a><a id="11464" class="Symbol">}</a> <a id="11466" class="Symbol">⦃</a> <a id="11468" href="Protocol.Streamlet.Consistency.html#11468" class="Bound">_</a> <a id="11470" class="Symbol">:</a> <a id="11472" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="11479" href="Protocol.Streamlet.Consistency.html#11451" class="Bound">p</a> <a id="11481" class="Symbol">⦄</a> <a id="11483" class="Symbol">⦃</a> <a id="11485" href="Protocol.Streamlet.Consistency.html#11485" class="Bound">_</a> <a id="11487" class="Symbol">:</a> <a id="11489" href="Protocol.Streamlet.Assumptions.html#1062" class="Field">Honest</a> <a id="11496" href="Protocol.Streamlet.Consistency.html#11453" class="Bound">p′</a> <a id="11499" class="Symbol">⦄</a> <a id="11501" class="Symbol">→</a>
  <a id="11505" class="Keyword">let</a>
    <a id="11513" href="Protocol.Streamlet.Consistency.html#11513" class="Bound">ms</a>  <a id="11517" class="Symbol">=</a> <a id="11519" class="Symbol">(</a><a id="11520" href="Protocol.Streamlet.Consistency.html#11444" class="Bound">s</a> <a id="11522" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="11524" href="Protocol.Streamlet.Consistency.html#11451" class="Bound">p</a><a id="11525" class="Symbol">)</a>  <a id="11528" class="Symbol">.</a><a id="11529" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
    <a id="11536" href="Protocol.Streamlet.Consistency.html#11536" class="Bound">ms′</a> <a id="11540" class="Symbol">=</a> <a id="11542" class="Symbol">(</a><a id="11543" href="Protocol.Streamlet.Consistency.html#11444" class="Bound">s</a> <a id="11545" href="Protocol.Streamlet.Global.State.html#1568" class="Function Operator">＠</a> <a id="11547" href="Protocol.Streamlet.Consistency.html#11453" class="Bound">p′</a><a id="11549" class="Symbol">)</a> <a id="11551" class="Symbol">.</a><a id="11552" href="Protocol.Streamlet.Local.State.html#961" class="Field">db</a>
  <a id="11557" class="Keyword">in</a>
  <a id="11562" href="Prelude.InferenceRules.html#56097" class="Function Operator">∙</a> <a id="11564" class="Symbol">(</a><a id="11565" href="Protocol.Streamlet.Consistency.html#11456" class="Bound">b</a> <a id="11567" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11569" href="Protocol.Streamlet.Consistency.html#11458" class="Bound">ch</a><a id="11571" class="Symbol">)</a> <a id="11573" href="Protocol.Streamlet.Local.State.html#1652" class="Datatype Operator">chain-∈</a> <a id="11581" href="Protocol.Streamlet.Consistency.html#11513" class="Bound">ms</a>
  <a id="11586" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="11588" href="Protocol.Streamlet.Local.State.html#3689" class="Datatype">FinalizedChain</a> <a id="11603" href="Protocol.Streamlet.Consistency.html#11513" class="Bound">ms</a> <a id="11606" href="Protocol.Streamlet.Consistency.html#11458" class="Bound">ch</a> <a id="11609" href="Protocol.Streamlet.Consistency.html#11456" class="Bound">b</a>
  <a id="11613" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="11615" href="Protocol.Streamlet.Consistency.html#11461" class="Bound">ch′</a> <a id="11619" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="11637" href="Protocol.Streamlet.Consistency.html#11536" class="Bound">ms′</a>
  <a id="11643" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="11645" href="Data.List.Base.html#5083" class="Function">length</a> <a id="11652" href="Protocol.Streamlet.Consistency.html#11458" class="Bound">ch</a> <a id="11655" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤</a> <a id="11657" href="Data.List.Base.html#5083" class="Function">length</a> <a id="11664" href="Protocol.Streamlet.Consistency.html#11461" class="Bound">ch′</a>
    <a id="11672" href="Prelude.InferenceRules.html#13789" class="Function Operator">──────────────────────────────</a>
    <a id="11707" href="Protocol.Streamlet.Consistency.html#11458" class="Bound">ch</a> <a id="11710" href="Protocol.Streamlet.Local.State.html#5234" class="Function Operator">≼</a> <a id="11712" href="Protocol.Streamlet.Consistency.html#11461" class="Bound">ch′</a>
</pre>
** Paper proof **
Suppose chain[: ℓ − 1] is not a prefix of or equal to chain'[: ℓ' − 1].
Then it must be that chain[ℓ − 1] ≠ chain'[ℓ − 1];
in other words, they have different blocks at length ℓ − 1.
However, Lemma 2 precludes both of chain[ℓ − 1] and chain'[ℓ − 1]
from getting notarized in honest view. ∎

<pre class="Agda"><a id="consistency"></a><a id="12038" href="Protocol.Streamlet.Consistency.html#12038" class="Function">consistency</a> <a id="12050" class="Symbol">:</a> <a id="12052" href="Prelude.Closures.html#3717" class="Function">Invariant</a> <a id="12062" href="Protocol.Streamlet.Consistency.html#11404" class="Function">Consistency</a>
<a id="12074" href="Protocol.Streamlet.Consistency.html#12038" class="Function">consistency</a> <a id="12086" class="Symbol">(_</a> <a id="12089" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12091" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="12096" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12098" class="Symbol">(_</a> <a id="12101" href="Prelude.Closures.html#689" class="InductiveConstructor Operator">∎</a><a id="12102" class="Symbol">))</a> <a id="12105" class="Symbol">{</a><a id="12106" href="Protocol.Streamlet.Consistency.html#12106" class="Bound">p</a><a id="12107" class="Symbol">}</a> <a id="12109" class="Symbol">(</a><a id="12110" href="Protocol.Streamlet.Consistency.html#12110" class="Bound">b∈</a> <a id="12113" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">∷</a> <a id="12115" class="Symbol">_</a> <a id="12117" href="Protocol.Streamlet.Local.State.html#1768" class="InductiveConstructor Operator">⊣</a> <a id="12119" class="Symbol">_)</a> <a id="12122" href="Protocol.Streamlet.Consistency.html#12122" class="Bound">fch</a> <a id="12126" href="Protocol.Streamlet.Consistency.html#12126" class="Bound">nch∈′</a> <a id="12132" href="Protocol.Streamlet.Consistency.html#12132" class="Bound">len≤</a>
  <a id="12139" class="Keyword">rewrite</a> <a id="12147" class="Keyword">let</a> <a id="12151" class="Keyword">open</a> <a id="12156" href="Protocol.Streamlet.Global.Step.html#3796" class="Module">∣Base∣</a> <a id="12163" href="Protocol.Streamlet.Consistency.html#12106" class="Bound">p</a> <a id="12165" class="Keyword">in</a> <a id="12168" href="Protocol.Streamlet.Global.Step.html#3830" class="Function">lookup✓</a>
  <a id="12178" class="Symbol">=</a> <a id="12180" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="12185" href="Protocol.Streamlet.Consistency.html#12110" class="Bound">b∈</a> <a id="12188" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="12191" class="Symbol">λ</a> <a id="12193" class="Symbol">()</a>
<a id="12196" href="Protocol.Streamlet.Consistency.html#12038" class="Function">consistency</a> <a id="12208" href="Protocol.Streamlet.Consistency.html#12208" class="Bound">Rs</a><a id="12210" class="Symbol">@(_</a> <a id="12214" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12216" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="12221" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12223" class="Symbol">(_</a> <a id="12226" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟨</a> <a id="12228" href="Protocol.Streamlet.Consistency.html#12228" class="Bound">x</a> <a id="12230" href="Prelude.Closures.html#709" class="InductiveConstructor Operator">⟩←—</a> <a id="12234" href="Protocol.Streamlet.Consistency.html#12234" class="Bound">tr</a><a id="12236" class="Symbol">))</a> <a id="12239" class="Symbol">{</a><a id="12240" href="Protocol.Streamlet.Consistency.html#12240" class="Bound">p</a><a id="12241" class="Symbol">}</a> <a id="12243" class="Symbol">{</a><a id="12244" class="Argument">ch</a> <a id="12247" class="Symbol">=</a> <a id="12249" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a><a id="12251" class="Symbol">}</a> <a id="12253" class="Symbol">{</a><a id="12254" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a><a id="12257" class="Symbol">}</a> <a id="12259" href="Protocol.Streamlet.Consistency.html#12259" class="Bound">ch∈</a> <a id="12263" href="Protocol.Streamlet.Consistency.html#12263" class="Bound">fch</a> <a id="12267" href="Protocol.Streamlet.Consistency.html#12267" class="Bound">nch∈′</a> <a id="12273" href="Protocol.Streamlet.Consistency.html#12273" class="Bound">len≤</a>
  <a id="12280" class="Symbol">=</a> <a id="12282" href="Protocol.Streamlet.Consistency.html#12718" class="Function">QED</a>
  <a id="12288" class="Keyword">where</a>
  <a id="12296" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a>   <a id="12300" class="Symbol">=</a> <a id="12302" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12309" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a> <a id="12313" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="12315" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12322" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a>
  <a id="12327" href="Protocol.Streamlet.Consistency.html#12327" class="Function">ch″</a> <a id="12331" class="Symbol">=</a> <a id="12333" href="Data.List.Base.html#9001" class="Function">L.drop</a> <a id="12340" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a> <a id="12342" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a>

  <a id="12349" href="Protocol.Streamlet.Consistency.html#12349" class="Function">len≡</a> <a id="12354" class="Symbol">:</a> <a id="12356" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12363" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a> <a id="12366" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12368" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12375" href="Protocol.Streamlet.Consistency.html#12327" class="Function">ch″</a>
  <a id="12381" href="Protocol.Streamlet.Consistency.html#12349" class="Function">len≡</a> <a id="12386" class="Symbol">=</a> <a id="12388" href="Relation.Binary.PropositionalEquality.Core.html#1712" class="Function">sym</a> <a id="12392" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="12394" href="Relation.Binary.Reasoning.Syntax.html#1510" class="Function Operator">≡-Reasoning.begin</a>
    <a id="12416" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12423" href="Protocol.Streamlet.Consistency.html#12327" class="Function">ch″</a>     <a id="12431" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="12434" href="Data.List.Properties.html#30754" class="Function">L.length-drop</a> <a id="12448" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a> <a id="12450" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a> <a id="12454" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
    <a id="12460" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12467" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a> <a id="12471" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="12473" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a> <a id="12475" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="12478" href="Data.Nat.Properties.html#50896" class="Function">Nat.m∸[m∸n]≡n</a> <a id="12492" href="Protocol.Streamlet.Consistency.html#12273" class="Bound">len≤</a> <a id="12497" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
    <a id="12503" href="Data.List.Base.html#5083" class="Function">length</a> <a id="12510" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a>      <a id="12518" href="Relation.Binary.Reasoning.Syntax.html#12283" class="Function Operator">≡-Reasoning.∎</a> <a id="12532" class="Keyword">where</a> <a id="12538" class="Keyword">open</a> <a id="12543" href="Relation.Binary.PropositionalEquality.Properties.html#6744" class="Module">≡-Reasoning</a>

  <a id="12558" href="Protocol.Streamlet.Consistency.html#12558" class="Function">nch∈″</a> <a id="12564" class="Symbol">:</a> <a id="12566" href="Protocol.Streamlet.Consistency.html#12327" class="Function">ch″</a> <a id="12570" href="Protocol.Streamlet.Local.State.html#3967" class="Function Operator">notarized-chain-∈</a> <a id="12588" class="Symbol">_</a>
  <a id="12592" href="Protocol.Streamlet.Consistency.html#12558" class="Function">nch∈″</a> <a id="12598" class="Symbol">=</a> <a id="12600" href="Protocol.Streamlet.Local.State.html#4942" class="Function">Suffix-nch∈</a> <a id="12612" class="Symbol">(</a><a id="12613" href="Prelude.Lists.html#15165" class="Function">Suffix-drop</a> <a id="12625" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a><a id="12626" class="Symbol">)</a> <a id="12628" href="Protocol.Streamlet.Consistency.html#12267" class="Bound">nch∈′</a>

  <a id="12637" href="Protocol.Streamlet.Consistency.html#12637" class="Function">QED′</a> <a id="12642" class="Symbol">:</a> <a id="12644" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a> <a id="12647" href="Protocol.Streamlet.Local.State.html#5234" class="Function Operator">≼</a> <a id="12649" href="Protocol.Streamlet.Consistency.html#12327" class="Function">ch″</a>
  <a id="12655" href="Protocol.Streamlet.Consistency.html#12637" class="Function">QED′</a> <a id="12660" class="Symbol">=</a> <a id="12662" href="Prelude.Lists.html#14739" class="Function">≡⇒Suffix</a> <a id="12671" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="12673" href="Protocol.Streamlet.Consistency.html#10576" class="Function">consistencyEqualLen</a> <a id="12693" href="Protocol.Streamlet.Consistency.html#12208" class="Bound">Rs</a> <a id="12696" href="Protocol.Streamlet.Consistency.html#12259" class="Bound">ch∈</a> <a id="12700" href="Protocol.Streamlet.Consistency.html#12558" class="Function">nch∈″</a> <a id="12706" href="Protocol.Streamlet.Consistency.html#12263" class="Bound">fch</a> <a id="12710" href="Protocol.Streamlet.Consistency.html#12349" class="Function">len≡</a>

  <a id="12718" href="Protocol.Streamlet.Consistency.html#12718" class="Function">QED</a> <a id="12722" class="Symbol">:</a> <a id="12724" href="Protocol.Streamlet.Consistency.html#12249" class="Bound">ch</a> <a id="12727" href="Protocol.Streamlet.Local.State.html#5234" class="Function Operator">≼</a> <a id="12729" href="Protocol.Streamlet.Consistency.html#12254" class="Bound">ch′</a>
  <a id="12735" href="Protocol.Streamlet.Consistency.html#12718" class="Function">QED</a> <a id="12739" class="Symbol">=</a> <a id="12741" href="Data.List.Relation.Binary.Suffix.Heterogeneous.Properties.html#3915" class="Function">L.Suf.trans</a> <a id="12753" href="Relation.Binary.PropositionalEquality.Core.html#1757" class="Function">trans</a> <a id="12759" href="Protocol.Streamlet.Consistency.html#12637" class="Function">QED′</a> <a id="12764" class="Symbol">(</a><a id="12765" href="Prelude.Lists.html#15165" class="Function">Suffix-drop</a> <a id="12777" href="Protocol.Streamlet.Consistency.html#12296" class="Function">n</a><a id="12778" class="Symbol">)</a>
</pre>